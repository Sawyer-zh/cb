# 抓取宁稳网的数据(每天中午, 下午收盘更新, 非实时, 但是最全)

from datetime import datetime
import sqlite3

import bs4
import requests

from utils import db_utils
from utils.db_utils import get_cursor

header = {
    "Referer": "http://www.ninwin.cn/index.php?m=profile",
    'User-Agent': "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36",
    # 'Cookie': "csrf_token=8919ea04925831e8; __51cke__=; P0s_winduser=RaqSRnBfFwDoLZv5tGFqXXLD4fXwVZQynHEOTJOsq1fzXIiXiCJW%2FWYIGis%3D; P0s_cbQuestion=1; __tins__4771153=%7B%22sid%22%3A%201631088120422%2C%20%22vd%22%3A%207%2C%20%22expires%22%3A%201631089976917%7D; __51laig__=234; PHPSESSID=jpl3tag9rff4l4mtdndsm36n44; P0s_visitor=Ncd58ncEEFs83Y9d2knG3OnEWpLyZm3YRPK8yFD6ja5fvV52; P0s_lastvisit=242%091631159109%09%2Findex.php%3Fm%3DmyAdmin%26c%3Dlog"
}


def get_content():
    # url = "https://www.jisilu.cn/data/cbnew/cb_index/"
    #
    # response = requests.get(url)
    # code = response.status_code
    # if code != 200:
    #     print("获取数据失败， 状态码：" + code)
    #
    # soup = bs4.BeautifulSoup(response.text, "html5lib")
    # table = soup.find_all('table')[1]
    # attr_id = table.attrs['id']
    # if 'table_cb_index' not in attr_id:
    #     print("table元素找的不对。id必须为cb_hq，实为：" + attr_id)
    #     return []
    # # 所有数据行 <tr>
    # trs = list(table.tbody.children)
    date = ['2017-12-29', '2018-01-02', '2018-01-03', '2018-01-04', '2018-01-05', '2018-01-08', '2018-01-09',
            '2018-01-10', '2018-01-11', '2018-01-12', '2018-01-15', '2018-01-16', '2018-01-17', '2018-01-18',
            '2018-01-19', '2018-01-22', '2018-01-23', '2018-01-24', '2018-01-25', '2018-01-26', '2018-01-29',
            '2018-01-30', '2018-01-31', '2018-02-01', '2018-02-02', '2018-02-05', '2018-02-06', '2018-02-07',
            '2018-02-08', '2018-02-09', '2018-02-12', '2018-02-13', '2018-02-14', '2018-02-22', '2018-02-23',
            '2018-02-26', '2018-02-27', '2018-02-28', '2018-03-01', '2018-03-02', '2018-03-05', '2018-03-06',
            '2018-03-07', '2018-03-08', '2018-03-09', '2018-03-12', '2018-03-13', '2018-03-14', '2018-03-15',
            '2018-03-16', '2018-03-19', '2018-03-20', '2018-03-21', '2018-03-22', '2018-03-23', '2018-03-26',
            '2018-03-27', '2018-03-28', '2018-03-29', '2018-03-30', '2018-04-02', '2018-04-03', '2018-04-04',
            '2018-04-09', '2018-04-10', '2018-04-11', '2018-04-12', '2018-04-13', '2018-04-16', '2018-04-17',
            '2018-04-18', '2018-04-19', '2018-04-20', '2018-04-23', '2018-04-24', '2018-04-25', '2018-04-26',
            '2018-04-27', '2018-05-02', '2018-05-03', '2018-05-04', '2018-05-07', '2018-05-08', '2018-05-09',
            '2018-05-10', '2018-05-11', '2018-05-14', '2018-05-15', '2018-05-16', '2018-05-17', '2018-05-18',
            '2018-05-21', '2018-05-22', '2018-05-23', '2018-05-24', '2018-05-25', '2018-05-28', '2018-05-29',
            '2018-05-30', '2018-05-31', '2018-06-01', '2018-06-04', '2018-06-05', '2018-06-06', '2018-06-07',
            '2018-06-08', '2018-06-11', '2018-06-12', '2018-06-13', '2018-06-14', '2018-06-15', '2018-06-19',
            '2018-06-20', '2018-06-21', '2018-06-22', '2018-06-25', '2018-06-26', '2018-06-27', '2018-06-28',
            '2018-06-29', '2018-07-02', '2018-07-03', '2018-07-04', '2018-07-05', '2018-07-06', '2018-07-09',
            '2018-07-10', '2018-07-11', '2018-07-12', '2018-07-13', '2018-07-16', '2018-07-17', '2018-07-18',
            '2018-07-19', '2018-07-20', '2018-07-23', '2018-07-24', '2018-07-25', '2018-07-26', '2018-07-27',
            '2018-07-30', '2018-07-31', '2018-08-01', '2018-08-02', '2018-08-03', '2018-08-06', '2018-08-07',
            '2018-08-08', '2018-08-09', '2018-08-10', '2018-08-13', '2018-08-14', '2018-08-15', '2018-08-16',
            '2018-08-17', '2018-08-20', '2018-08-21', '2018-08-22', '2018-08-23', '2018-08-24', '2018-08-27',
            '2018-08-28', '2018-08-29', '2018-08-30', '2018-08-31', '2018-09-03', '2018-09-04', '2018-09-05',
            '2018-09-06', '2018-09-07', '2018-09-10', '2018-09-11', '2018-09-12', '2018-09-13', '2018-09-14',
            '2018-09-17', '2018-09-18', '2018-09-19', '2018-09-20', '2018-09-21', '2018-09-25', '2018-09-26',
            '2018-09-27', '2018-09-28', '2018-10-08', '2018-10-09', '2018-10-10', '2018-10-11', '2018-10-12',
            '2018-10-15', '2018-10-16', '2018-10-17', '2018-10-18', '2018-10-19', '2018-10-22', '2018-10-23',
            '2018-10-24', '2018-10-25', '2018-10-26', '2018-10-29', '2018-10-30', '2018-10-31', '2018-11-01',
            '2018-11-02', '2018-11-05', '2018-11-06', '2018-11-07', '2018-11-08', '2018-11-09', '2018-11-12',
            '2018-11-13', '2018-11-14', '2018-11-15', '2018-11-16', '2018-11-19', '2018-11-20', '2018-11-21',
            '2018-11-22', '2018-11-23', '2018-11-26', '2018-11-27', '2018-11-28', '2018-11-29', '2018-11-30',
            '2018-12-03', '2018-12-04', '2018-12-05', '2018-12-06', '2018-12-07', '2018-12-10', '2018-12-11',
            '2018-12-12', '2018-12-13', '2018-12-14', '2018-12-17', '2018-12-18', '2018-12-19', '2018-12-20',
            '2018-12-21', '2018-12-24', '2018-12-25', '2018-12-26', '2018-12-27', '2018-12-28', '2019-01-02',
            '2019-01-03', '2019-01-04', '2019-01-07', '2019-01-08', '2019-01-09', '2019-01-10', '2019-01-11',
            '2019-01-14', '2019-01-15', '2019-01-16', '2019-01-17', '2019-01-18', '2019-01-21', '2019-01-22',
            '2019-01-23', '2019-01-24', '2019-01-25', '2019-01-28', '2019-01-29', '2019-01-30', '2019-01-31',
            '2019-02-01', '2019-02-11', '2019-02-12', '2019-02-13', '2019-02-14', '2019-02-15', '2019-02-18',
            '2019-02-19', '2019-02-20', '2019-02-21', '2019-02-22', '2019-02-25', '2019-02-26', '2019-02-27',
            '2019-02-28', '2019-03-01', '2019-03-04', '2019-03-05', '2019-03-06', '2019-03-07', '2019-03-08',
            '2019-03-11', '2019-03-12', '2019-03-13', '2019-03-14', '2019-03-15', '2019-03-18', '2019-03-19',
            '2019-03-20', '2019-03-21', '2019-03-22', '2019-03-25', '2019-03-26', '2019-03-27', '2019-03-28',
            '2019-03-29', '2019-04-01', '2019-04-02', '2019-04-03', '2019-04-04', '2019-04-08', '2019-04-09',
            '2019-04-10', '2019-04-11', '2019-04-12', '2019-04-15', '2019-04-16', '2019-04-17', '2019-04-18',
            '2019-04-19', '2019-04-22', '2019-04-23', '2019-04-24', '2019-04-25', '2019-04-26', '2019-04-29',
            '2019-04-30', '2019-05-06', '2019-05-07', '2019-05-08', '2019-05-09', '2019-05-10', '2019-05-13',
            '2019-05-14', '2019-05-15', '2019-05-16', '2019-05-17', '2019-05-20', '2019-05-21', '2019-05-22',
            '2019-05-23', '2019-05-24', '2019-05-27', '2019-05-28', '2019-05-29', '2019-05-30', '2019-05-31',
            '2019-06-03', '2019-06-04', '2019-06-05', '2019-06-06', '2019-06-10', '2019-06-11', '2019-06-12',
            '2019-06-13', '2019-06-14', '2019-06-17', '2019-06-18', '2019-06-19', '2019-06-20', '2019-06-21',
            '2019-06-24', '2019-06-25', '2019-06-26', '2019-06-27', '2019-06-28', '2019-07-01', '2019-07-02',
            '2019-07-03', '2019-07-04', '2019-07-05', '2019-07-08', '2019-07-09', '2019-07-10', '2019-07-11',
            '2019-07-12', '2019-07-15', '2019-07-16', '2019-07-17', '2019-07-18', '2019-07-19', '2019-07-22',
            '2019-07-23', '2019-07-24', '2019-07-25', '2019-07-26', '2019-07-29', '2019-07-30', '2019-07-31',
            '2019-08-01', '2019-08-02', '2019-08-05', '2019-08-06', '2019-08-07', '2019-08-08', '2019-08-09',
            '2019-08-12', '2019-08-13', '2019-08-14', '2019-08-15', '2019-08-16', '2019-08-19', '2019-08-20',
            '2019-08-21', '2019-08-22', '2019-08-23', '2019-08-26', '2019-08-27', '2019-08-28', '2019-08-29',
            '2019-08-30', '2019-09-02', '2019-09-03', '2019-09-04', '2019-09-05', '2019-09-06', '2019-09-09',
            '2019-09-10', '2019-09-11', '2019-09-12', '2019-09-16', '2019-09-17', '2019-09-18', '2019-09-19',
            '2019-09-20', '2019-09-23', '2019-09-24', '2019-09-25', '2019-09-26', '2019-09-27', '2019-09-30',
            '2019-10-08', '2019-10-09', '2019-10-10', '2019-10-11', '2019-10-14', '2019-10-15', '2019-10-16',
            '2019-10-17', '2019-10-18', '2019-10-21', '2019-10-22', '2019-10-23', '2019-10-24', '2019-10-25',
            '2019-10-28', '2019-10-29', '2019-10-30', '2019-10-31', '2019-11-01', '2019-11-04', '2019-11-05',
            '2019-11-06', '2019-11-07', '2019-11-08', '2019-11-11', '2019-11-12', '2019-11-13', '2019-11-14',
            '2019-11-15', '2019-11-18', '2019-11-19', '2019-11-20', '2019-11-21', '2019-11-22', '2019-11-25',
            '2019-11-26', '2019-11-27', '2019-11-28', '2019-11-29', '2019-12-02', '2019-12-03', '2019-12-04',
            '2019-12-05', '2019-12-06', '2019-12-09', '2019-12-10', '2019-12-11', '2019-12-12', '2019-12-13',
            '2019-12-16', '2019-12-17', '2019-12-18', '2019-12-19', '2019-12-20', '2019-12-23', '2019-12-24',
            '2019-12-25', '2019-12-26', '2019-12-27', '2019-12-30', '2019-12-31', '2020-01-02', '2020-01-03',
            '2020-01-06', '2020-01-07', '2020-01-08', '2020-01-09', '2020-01-10', '2020-01-13', '2020-01-14',
            '2020-01-15', '2020-01-16', '2020-01-17', '2020-01-20', '2020-01-21', '2020-01-22', '2020-01-23',
            '2020-02-03', '2020-02-04', '2020-02-05', '2020-02-06', '2020-02-07', '2020-02-10', '2020-02-11',
            '2020-02-12', '2020-02-13', '2020-02-14', '2020-02-17', '2020-02-18', '2020-02-19', '2020-02-20',
            '2020-02-21', '2020-02-24', '2020-02-25', '2020-02-26', '2020-02-27', '2020-02-28', '2020-03-02',
            '2020-03-03', '2020-03-04', '2020-03-05', '2020-03-06', '2020-03-09', '2020-03-10', '2020-03-11',
            '2020-03-12', '2020-03-13', '2020-03-16', '2020-03-17', '2020-03-18', '2020-03-19', '2020-03-20',
            '2020-03-23', '2020-03-24', '2020-03-25', '2020-03-26', '2020-03-27', '2020-03-30', '2020-03-31',
            '2020-04-01', '2020-04-02', '2020-04-03', '2020-04-07', '2020-04-08', '2020-04-09', '2020-04-10',
            '2020-04-13', '2020-04-14', '2020-04-15', '2020-04-16', '2020-04-17', '2020-04-20', '2020-04-21',
            '2020-04-22', '2020-04-23', '2020-04-24', '2020-04-27', '2020-04-28', '2020-04-29', '2020-04-30',
            '2020-05-06', '2020-05-07', '2020-05-08', '2020-05-11', '2020-05-12', '2020-05-13', '2020-05-14',
            '2020-05-15', '2020-05-18', '2020-05-19', '2020-05-20', '2020-05-21', '2020-05-22', '2020-05-25',
            '2020-05-26', '2020-05-27', '2020-05-28', '2020-05-29', '2020-06-01', '2020-06-02', '2020-06-03',
            '2020-06-04', '2020-06-05', '2020-06-08', '2020-06-09', '2020-06-10', '2020-06-11', '2020-06-12',
            '2020-06-15', '2020-06-16', '2020-06-17', '2020-06-18', '2020-06-19', '2020-06-22', '2020-06-23',
            '2020-06-24', '2020-06-29', '2020-06-30', '2020-07-01', '2020-07-02', '2020-07-03', '2020-07-06',
            '2020-07-07', '2020-07-08', '2020-07-09', '2020-07-10', '2020-07-13', '2020-07-14', '2020-07-15',
            '2020-07-16', '2020-07-17', '2020-07-20', '2020-07-21', '2020-07-22', '2020-07-23', '2020-07-24',
            '2020-07-27', '2020-07-28', '2020-07-29', '2020-07-30', '2020-07-31', '2020-08-03', '2020-08-04',
            '2020-08-05', '2020-08-06', '2020-08-07', '2020-08-10', '2020-08-11', '2020-08-12', '2020-08-13',
            '2020-08-14', '2020-08-17', '2020-08-18', '2020-08-19', '2020-08-20', '2020-08-21', '2020-08-24',
            '2020-08-25', '2020-08-26', '2020-08-27', '2020-08-28', '2020-08-31', '2020-09-01', '2020-09-02',
            '2020-09-03', '2020-09-04', '2020-09-07', '2020-09-08', '2020-09-09', '2020-09-10', '2020-09-11',
            '2020-09-14', '2020-09-15', '2020-09-16', '2020-09-17', '2020-09-18', '2020-09-21', '2020-09-22',
            '2020-09-23', '2020-09-24', '2020-09-25', '2020-09-28', '2020-09-29', '2020-09-30', '2020-10-09',
            '2020-10-12', '2020-10-13', '2020-10-14', '2020-10-15', '2020-10-16', '2020-10-19', '2020-10-20',
            '2020-10-21', '2020-10-22', '2020-10-23', '2020-10-26', '2020-10-27', '2020-10-28', '2020-10-29',
            '2020-10-30', '2020-11-02', '2020-11-03', '2020-11-04', '2020-11-05', '2020-11-06', '2020-11-09',
            '2020-11-10', '2020-11-11', '2020-11-12', '2020-11-13', '2020-11-16', '2020-11-17', '2020-11-18',
            '2020-11-19', '2020-11-20', '2020-11-23', '2020-11-24', '2020-11-25', '2020-11-26', '2020-11-27',
            '2020-11-30', '2020-12-01', '2020-12-02', '2020-12-03', '2020-12-04', '2020-12-07', '2020-12-08',
            '2020-12-09', '2020-12-10', '2020-12-11', '2020-12-14', '2020-12-15', '2020-12-16', '2020-12-17',
            '2020-12-18', '2020-12-21', '2020-12-22', '2020-12-23', '2020-12-24', '2020-12-25', '2020-12-28',
            '2020-12-29', '2020-12-30', '2020-12-31', '2021-01-04', '2021-01-05', '2021-01-06', '2021-01-07',
            '2021-01-08', '2021-01-11', '2021-01-12', '2021-01-13', '2021-01-14', '2021-01-15', '2021-01-18',
            '2021-01-19', '2021-01-20', '2021-01-21', '2021-01-22', '2021-01-25', '2021-01-26', '2021-01-27',
            '2021-01-28', '2021-01-29', '2021-02-01', '2021-02-02', '2021-02-03', '2021-02-04', '2021-02-05',
            '2021-02-08', '2021-02-09', '2021-02-10', '2021-02-18', '2021-02-19', '2021-02-22', '2021-02-23',
            '2021-02-24', '2021-02-25', '2021-02-26', '2021-03-01', '2021-03-02', '2021-03-03', '2021-03-04',
            '2021-03-05', '2021-03-08', '2021-03-09', '2021-03-10', '2021-03-11', '2021-03-12', '2021-03-15',
            '2021-03-16', '2021-03-17', '2021-03-18', '2021-03-19', '2021-03-22', '2021-03-23', '2021-03-24',
            '2021-03-25', '2021-03-26', '2021-03-29', '2021-03-30', '2021-03-31', '2021-04-01', '2021-04-02',
            '2021-04-06', '2021-04-07', '2021-04-08', '2021-04-09', '2021-04-12', '2021-04-13', '2021-04-14',
            '2021-04-15', '2021-04-16', '2021-04-19', '2021-04-20', '2021-04-21', '2021-04-22', '2021-04-23',
            '2021-04-26', '2021-04-27', '2021-04-28', '2021-04-29', '2021-04-30', '2021-05-06', '2021-05-07',
            '2021-05-10', '2021-05-11', '2021-05-12', '2021-05-13', '2021-05-14', '2021-05-17', '2021-05-18',
            '2021-05-19', '2021-05-20', '2021-05-21', '2021-05-24', '2021-05-25', '2021-05-26', '2021-05-27',
            '2021-05-28', '2021-05-31', '2021-06-01', '2021-06-02', '2021-06-03', '2021-06-04', '2021-06-07',
            '2021-06-08', '2021-06-09', '2021-06-10', '2021-06-11', '2021-06-15', '2021-06-16', '2021-06-17',
            '2021-06-18', '2021-06-21', '2021-06-22', '2021-06-23', '2021-06-24', '2021-06-25', '2021-06-28',
            '2021-06-29', '2021-06-30', '2021-07-01', '2021-07-02', '2021-07-05', '2021-07-06', '2021-07-07',
            '2021-07-08', '2021-07-09', '2021-07-12', '2021-07-13', '2021-07-14', '2021-07-15', '2021-07-16',
            '2021-07-19', '2021-07-20', '2021-07-21', '2021-07-22', '2021-07-23', '2021-07-26', '2021-07-27',
            '2021-07-28', '2021-07-29', '2021-07-30', '2021-08-02', '2021-08-03', '2021-08-04', '2021-08-05',
            '2021-08-06', '2021-08-09', '2021-08-10', '2021-08-11', '2021-08-12', '2021-08-13', '2021-08-16',
            '2021-08-17', '2021-08-18', '2021-08-19', '2021-08-20', '2021-08-23', '2021-08-24', '2021-08-25',
            '2021-08-26', '2021-08-27', '2021-08-30', '2021-08-31', '2021-09-01', '2021-09-02', '2021-09-03',
            '2021-09-06', '2021-09-07', '2021-09-08', '2021-09-09', '2021-09-10', '2021-09-13', '2021-09-14',
            '2021-09-15', '2021-09-16', '2021-09-17', '2021-09-22', '2021-09-23', '2021-09-24', '2021-09-27',
            '2021-09-28', '2021-09-29', '2021-09-30', '2021-10-08', '2021-10-11', '2021-10-12', '2021-10-13',
            '2021-10-14', '2021-10-15', '2021-10-18']
    mid_price = [104.111, 104.800, 105.210, 104.655, 107.000, 107.805, 106.371, 105.750, 106.080, 105.836, 104.145,
                 103.720, 104.176, 104.350, 104.510, 105.740, 106.271, 106.710, 107.322, 106.195, 104.968, 105.500,
                 105.140, 103.846, 103.760, 103.630, 102.084, 102.000, 102.391, 101.980, 103.910, 103.920, 104.200,
                 104.429, 104.110, 105.725, 105.845, 105.771, 106.030, 105.615, 105.250, 105.725, 106.000, 105.835,
                 105.875, 107.065, 107.237, 106.685, 106.700, 105.820, 106.598, 105.760, 106.000, 106.130, 104.780,
                 105.155, 106.035, 105.400, 105.200, 105.800, 105.800, 105.728, 105.470, 105.990, 105.725, 105.992,
                 106.139, 105.829, 105.213, 104.805, 105.170, 106.000, 104.230, 103.870, 104.590, 105.030, 103.205,
                 103.505, 103.235, 103.845, 104.379, 104.850, 104.995, 104.815, 104.780, 104.620, 104.475, 104.645,
                 104.730, 104.820, 104.690, 105.360, 105.245, 105.100, 104.670, 104.150, 103.760, 103.420, 101.770,
                 102.220, 102.000, 101.040, 101.645, 102.070, 102.200, 101.510, 101.000, 101.100, 101.392, 100.386,
                 99.865, 96.420, 97.100, 96.345, 96.094, 97.280, 97.250, 96.699, 96.560, 97.938, 97.164, 97.965, 97.855,
                 97.445, 97.740, 98.700, 99.300, 98.125, 99.975, 100.660, 99.615, 99.905, 99.915, 100.025, 100.178,
                 100.238, 101.020, 100.560, 99.940, 99.745, 99.395, 99.250, 99.444, 98.470, 98.000, 97.890, 98.580,
                 98.580, 99.640, 99.385, 99.480, 99.200, 98.740, 97.921, 97.320, 97.950, 98.170, 97.595, 98.015, 97.620,
                 98.880, 98.970, 98.600, 98.458, 98.032, 97.915, 98.070, 97.803, 97.706, 97.745, 97.260, 97.275, 97.345,
                 97.390, 97.120, 96.747, 96.861, 97.015, 97.070, 97.489, 97.510, 97.578, 97.002, 97.475, 96.553, 96.558,
                 96.480, 94.420, 94.600, 94.180, 93.750, 93.790, 93.132, 93.510, 95.299, 94.764, 94.800, 94.510, 95.002,
                 94.450, 94.490, 94.888, 95.250, 96.399, 96.780, 96.300, 96.600, 96.353, 96.200, 96.671, 97.206, 97.940,
                 98.205, 99.180, 99.361, 98.540, 98.482, 98.500, 97.445, 97.450, 97.670, 98.300, 97.720, 97.715, 98.910,
                 99.370, 99.239, 98.890, 98.840, 98.595, 98.660, 98.850, 99.300, 99.100, 98.600, 98.490, 98.295, 98.090,
                 97.626, 97.761, 97.505, 97.300, 97.510, 97.602, 97.210, 97.060, 97.770, 98.500, 98.451, 99.545, 99.800,
                 99.810, 99.911, 100.425, 100.510, 99.964, 100.267, 100.500, 100.230, 100.240, 100.365, 101.125,
                 100.735, 100.490, 100.205, 100.070, 100.910, 102.010, 102.660, 103.500, 104.010, 104.329, 105.610,
                 105.810, 105.840, 106.070, 107.146, 109.990, 109.450, 109.600, 109.600, 110.201, 111.000, 112.340,
                 113.350, 113.220, 112.255, 114.550, 115.490, 113.615, 111.571, 112.299, 114.660, 116.200, 115.760,
                 116.571, 116.856, 115.000, 113.005, 112.625, 112.690, 114.010, 117.310, 118.100, 118.432, 119.406,
                 119.600, 118.988, 118.300, 116.275, 116.145, 114.950, 114.919, 114.874, 115.030, 115.295, 114.130,
                 113.000, 112.260, 109.685, 108.981, 107.140, 108.140, 104.790, 105.447, 105.830, 105.555, 107.508,
                 107.099, 107.250, 108.220, 109.350, 106.750, 106.056, 106.895, 106.905, 106.080, 105.952, 106.251,
                 106.294, 105.990, 105.031, 104.635, 103.750, 102.990, 102.969, 101.890, 102.371, 104.235, 104.200,
                 104.120, 103.399, 103.030, 102.670, 103.025, 104.630, 105.815, 105.710, 105.500, 105.580, 106.115,
                 105.525, 106.794, 107.290, 107.085, 107.130, 107.137, 105.880, 105.975, 105.801, 105.660, 105.855,
                 105.875, 106.283, 106.429, 106.051, 106.126, 105.230, 105.255, 105.550, 105.940, 106.880, 107.170,
                 107.435, 107.510, 107.100, 106.660, 106.010, 105.550, 105.785, 105.765, 105.830, 106.206, 106.085,
                 106.020, 106.070, 106.150, 107.596, 107.774, 107.700, 107.490, 107.793, 107.870, 108.170, 108.620,
                 108.500, 108.000, 108.300, 108.350, 108.520, 109.800, 110.010, 110.960, 111.226, 110.960, 110.660,
                 110.410, 109.065, 109.230, 109.501, 109.800, 109.350, 109.730, 109.568, 108.550, 109.231, 108.844,
                 109.036, 109.099, 110.000, 110.135, 110.881, 110.580, 110.290, 110.300, 109.808, 108.851, 109.175,
                 109.228, 109.005, 109.563, 110.160, 109.700, 108.826, 108.317, 108.545, 108.425, 108.678, 108.723,
                 108.900, 109.057, 108.300, 108.157, 108.250, 108.300, 107.700, 108.180, 108.810, 108.850, 108.362,
                 108.050, 108.309, 108.030, 108.500, 108.225, 107.800, 107.800, 108.070, 108.418, 108.601, 108.983,
                 109.185, 109.950, 110.130, 110.060, 110.772, 112.348, 113.110, 113.496, 113.255, 113.260, 112.289,
                 113.100, 113.093, 113.933, 113.750, 114.845, 116.250, 116.770, 117.000, 117.470, 118.000, 117.210,
                 117.980, 117.690, 118.000, 118.800, 118.350, 117.675, 117.434, 117.900, 117.820, 117.856, 116.140,
                 110.861, 113.500, 115.000, 115.700, 115.689, 115.440, 115.810, 116.710, 115.995, 116.785, 118.901,
                 119.050, 119.763, 121.250, 121.830, 122.850, 122.996, 121.498, 121.330, 118.061, 119.847, 120.280,
                 120.870, 123.000, 123.020, 120.001, 121.300, 121.545, 119.895, 118.950, 116.060, 116.310, 116.200,
                 116.100, 118.635, 115.504, 117.415, 119.335, 118.600, 118.000, 117.365, 117.510, 117.710, 117.695,
                 116.530, 117.300, 117.380, 117.116, 115.200, 114.000, 115.150, 116.000, 116.100, 116.560, 116.765,
                 116.287, 117.090, 117.220, 115.900, 116.600, 116.180, 116.240, 116.580, 117.010, 115.979, 116.521,
                 116.319, 115.980, 115.540, 114.809, 114.600, 112.890, 113.000, 111.495, 110.960, 110.095, 109.900,
                 110.707, 110.955, 111.045, 111.900, 113.570, 114.177, 113.945, 113.358, 113.021, 112.903, 113.010,
                 112.578, 112.150, 112.502, 112.775, 113.253, 113.353, 113.260, 113.545, 113.510, 112.945, 113.100,
                 112.821, 112.760, 113.440, 115.235, 116.370, 119.795, 120.020, 121.740, 123.170, 121.861, 124.600,
                 124.130, 122.000, 118.000, 118.299, 122.070, 121.640, 123.200, 122.605, 119.840, 119.020, 120.000,
                 121.000, 121.880, 122.010, 124.290, 123.215, 124.000, 124.290, 123.050, 124.650, 123.700, 122.000,
                 121.575, 122.176, 123.575, 124.000, 123.390, 122.336, 122.355, 122.553, 122.475, 120.495, 120.705,
                 121.436, 122.252, 123.229, 123.495, 123.080, 122.605, 121.300, 121.500, 120.100, 118.350, 118.925,
                 119.165, 119.000, 118.020, 118.500, 119.170, 118.930, 118.365, 118.600, 116.856, 116.050, 114.340,
                 115.726, 115.949, 117.406, 119.440, 119.540, 119.617, 119.375, 119.805, 118.965, 119.750, 119.499,
                 121.440, 119.485, 120.165, 121.255, 121.150, 121.013, 119.090, 117.300, 117.404, 117.443, 117.859,
                 117.675, 119.000, 118.690, 118.672, 118.475, 119.000, 119.008, 117.565, 118.040, 118.300, 118.035,
                 118.470, 119.200, 119.010, 117.998, 117.990, 117.949, 118.380, 118.050, 118.900, 118.500, 118.225,
                 117.860, 117.000, 116.528, 115.040, 115.210, 113.642, 113.002, 112.672, 112.430, 113.105, 112.270,
                 111.744, 110.010, 110.050, 109.354, 109.811, 110.199, 111.535, 112.465, 112.000, 111.605, 109.160,
                 109.430, 108.405, 108.905, 107.987, 108.634, 109.235, 110.310, 110.300, 110.127, 110.750, 110.140,
                 109.075, 108.100, 107.010, 106.320, 104.521, 104.040, 103.995, 103.000, 101.585, 100.690, 100.560,
                 101.985, 103.070, 104.517, 106.103, 106.770, 106.635, 106.320, 105.500, 105.371, 106.240, 105.394,
                 106.500, 105.955, 106.330, 106.028, 105.322, 105.880, 106.557, 107.000, 107.425, 107.763, 107.710,
                 107.430, 107.500, 108.440, 107.630, 107.010, 106.655, 107.050, 107.025, 106.502, 106.770, 107.475,
                 107.000, 107.750, 108.020, 107.851, 107.820, 107.206, 106.858, 107.035, 107.125, 107.450, 108.413,
                 108.607, 108.510, 108.490, 108.199, 108.238, 107.865, 108.050, 107.655, 107.896, 108.131, 107.759,
                 108.189, 109.442, 109.340, 109.300, 109.328, 109.289, 109.595, 109.660, 109.880, 109.860, 110.332,
                 110.790, 111.300, 111.721, 111.110, 111.700, 111.586, 112.071, 112.480, 112.490, 112.130, 112.500,
                 112.610, 112.771, 113.032, 111.902, 111.600, 110.790, 110.775, 111.380, 112.810, 113.078, 112.771,
                 112.825, 112.795, 112.100, 112.410, 112.419, 112.026, 111.976, 112.300, 113.578, 113.170, 114.278,
                 114.870, 115.639, 115.950, 115.411, 115.735, 115.237, 115.375, 116.450, 116.899, 117.215, 116.080,
                 114.700, 113.446, 114.590, 114.820, 116.700, 116.450, 117.616, 118.000, 118.125, 118.666, 119.243,
                 119.350, 119.531, 119.300, 119.370, 118.455, 118.680, 118.221, 117.258, 118.830, 119.674, 120.397,
                 120.050, 119.180, 119.900, 120.131, 120.300, 121.310, 121.997, 122.790, 123.990, 124.270, 124.201,
                 123.296, 123.800, 122.650, 121.993, 120.470, 120.050, 120.500, 121.380, 120.890, 118.870, 119.308,
                 117.040, 118.850, 119.545, 119.700, 117.960, 117.720, 117.660, 117.989, 118.014]

    return build_rows(date, mid_price)


def build_rows(date, mid_price):
    rows = []
    # 遍历所有行

    i = 0
    for d in date:
        p = mid_price[i]
        row = {'date': datetime.strptime(d, '%Y-%m-%d'), 'mid_price': p}
        rows.append(row)
        i += 1
    return rows


def build_row(row, td, i):
    text = td.text.strip()
    if i == 1:
        row['date'] = datetime.strptime(text, '%Y-%m-%d')
    else:
        row['mid_price'] = text


def insert_db(rows):
    err_row = None
    try:
        i = 0
        with db_utils.get_connect() as con:
            cur = con.cursor()
            for row in rows:
                err_row = row
                result = cur.execute("""insert into cb_index_history( date, mid_price) values(:date, :mid_price)""",
                                     {'date': row['date'], 'mid_price': row['mid_price']})
                if result.rowcount != 1:
                    print('insert db_index is failure. row:' + row['date'])
                else:
                    i += 1

        print("insert db_index is complete. count:" + str(i))

    except Exception as e:
        # cur_file.close()
        print("db操作出现异常. err_row" + str(err_row), e)
        raise e


def fetch_data():
    rows = get_content()
    insert_db(rows)
    return 'OK'


if __name__ == "__main__":
    # fetch_data()

    print("可转债数据抓取更新完成")
