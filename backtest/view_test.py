import datetime
import json

from pyecharts import options as opts
from pyecharts.charts import Line, Timeline, Bar
from pyecharts.globals import ThemeType

from backtest.test_utils import get_max_drawdown
from utils.html_utils import env
import numpy as np

# from empyrical import max_drawdown, alpha_beta

# fixme 手工更新
index_date = ['2017-12-29', '2018-01-02', '2018-01-03', '2018-01-04', '2018-01-05', '2018-01-08', '2018-01-09',
              '2018-01-10', '2018-01-11', '2018-01-12', '2018-01-15', '2018-01-16', '2018-01-17', '2018-01-18',
              '2018-01-19', '2018-01-22', '2018-01-23', '2018-01-24', '2018-01-25', '2018-01-26', '2018-01-29',
              '2018-01-30', '2018-01-31', '2018-02-01', '2018-02-02', '2018-02-05', '2018-02-06', '2018-02-07',
              '2018-02-08', '2018-02-09', '2018-02-12', '2018-02-13', '2018-02-14', '2018-02-22', '2018-02-23',
              '2018-02-26', '2018-02-27', '2018-02-28', '2018-03-01', '2018-03-02', '2018-03-05', '2018-03-06',
              '2018-03-07', '2018-03-08', '2018-03-09', '2018-03-12', '2018-03-13', '2018-03-14', '2018-03-15',
              '2018-03-16', '2018-03-19', '2018-03-20', '2018-03-21', '2018-03-22', '2018-03-23', '2018-03-26',
              '2018-03-27', '2018-03-28', '2018-03-29', '2018-03-30', '2018-04-02', '2018-04-03', '2018-04-04',
              '2018-04-09', '2018-04-10', '2018-04-11', '2018-04-12', '2018-04-13', '2018-04-16', '2018-04-17',
              '2018-04-18', '2018-04-19', '2018-04-20', '2018-04-23', '2018-04-24', '2018-04-25', '2018-04-26',
              '2018-04-27', '2018-05-02', '2018-05-03', '2018-05-04', '2018-05-07', '2018-05-08', '2018-05-09',
              '2018-05-10', '2018-05-11', '2018-05-14', '2018-05-15', '2018-05-16', '2018-05-17', '2018-05-18',
              '2018-05-21', '2018-05-22', '2018-05-23', '2018-05-24', '2018-05-25', '2018-05-28', '2018-05-29',
              '2018-05-30', '2018-05-31', '2018-06-01', '2018-06-04', '2018-06-05', '2018-06-06', '2018-06-07',
              '2018-06-08', '2018-06-11', '2018-06-12', '2018-06-13', '2018-06-14', '2018-06-15', '2018-06-19',
              '2018-06-20', '2018-06-21', '2018-06-22', '2018-06-25', '2018-06-26', '2018-06-27', '2018-06-28',
              '2018-06-29', '2018-07-02', '2018-07-03', '2018-07-04', '2018-07-05', '2018-07-06', '2018-07-09',
              '2018-07-10', '2018-07-11', '2018-07-12', '2018-07-13', '2018-07-16', '2018-07-17', '2018-07-18',
              '2018-07-19', '2018-07-20', '2018-07-23', '2018-07-24', '2018-07-25', '2018-07-26', '2018-07-27',
              '2018-07-30', '2018-07-31', '2018-08-01', '2018-08-02', '2018-08-03', '2018-08-06', '2018-08-07',
              '2018-08-08', '2018-08-09', '2018-08-10', '2018-08-13', '2018-08-14', '2018-08-15', '2018-08-16',
              '2018-08-17', '2018-08-20', '2018-08-21', '2018-08-22', '2018-08-23', '2018-08-24', '2018-08-27',
              '2018-08-28', '2018-08-29', '2018-08-30', '2018-08-31', '2018-09-03', '2018-09-04', '2018-09-05',
              '2018-09-06', '2018-09-07', '2018-09-10', '2018-09-11', '2018-09-12', '2018-09-13', '2018-09-14',
              '2018-09-17', '2018-09-18', '2018-09-19', '2018-09-20', '2018-09-21', '2018-09-25', '2018-09-26',
              '2018-09-27', '2018-09-28', '2018-10-08', '2018-10-09', '2018-10-10', '2018-10-11', '2018-10-12',
              '2018-10-15', '2018-10-16', '2018-10-17', '2018-10-18', '2018-10-19', '2018-10-22', '2018-10-23',
              '2018-10-24', '2018-10-25', '2018-10-26', '2018-10-29', '2018-10-30', '2018-10-31', '2018-11-01',
              '2018-11-02', '2018-11-05', '2018-11-06', '2018-11-07', '2018-11-08', '2018-11-09', '2018-11-12',
              '2018-11-13', '2018-11-14', '2018-11-15', '2018-11-16', '2018-11-19', '2018-11-20', '2018-11-21',
              '2018-11-22', '2018-11-23', '2018-11-26', '2018-11-27', '2018-11-28', '2018-11-29', '2018-11-30',
              '2018-12-03', '2018-12-04', '2018-12-05', '2018-12-06', '2018-12-07', '2018-12-10', '2018-12-11',
              '2018-12-12', '2018-12-13', '2018-12-14', '2018-12-17', '2018-12-18', '2018-12-19', '2018-12-20',
              '2018-12-21', '2018-12-24', '2018-12-25', '2018-12-26', '2018-12-27', '2018-12-28', '2019-01-02',
              '2019-01-03', '2019-01-04', '2019-01-07', '2019-01-08', '2019-01-09', '2019-01-10', '2019-01-11',
              '2019-01-14', '2019-01-15', '2019-01-16', '2019-01-17', '2019-01-18', '2019-01-21', '2019-01-22',
              '2019-01-23', '2019-01-24', '2019-01-25', '2019-01-28', '2019-01-29', '2019-01-30', '2019-01-31',
              '2019-02-01', '2019-02-11', '2019-02-12', '2019-02-13', '2019-02-14', '2019-02-15', '2019-02-18',
              '2019-02-19', '2019-02-20', '2019-02-21', '2019-02-22', '2019-02-25', '2019-02-26', '2019-02-27',
              '2019-02-28', '2019-03-01', '2019-03-04', '2019-03-05', '2019-03-06', '2019-03-07', '2019-03-08',
              '2019-03-11', '2019-03-12', '2019-03-13', '2019-03-14', '2019-03-15', '2019-03-18', '2019-03-19',
              '2019-03-20', '2019-03-21', '2019-03-22', '2019-03-25', '2019-03-26', '2019-03-27', '2019-03-28',
              '2019-03-29', '2019-04-01', '2019-04-02', '2019-04-03', '2019-04-04', '2019-04-08', '2019-04-09',
              '2019-04-10', '2019-04-11', '2019-04-12', '2019-04-15', '2019-04-16', '2019-04-17', '2019-04-18',
              '2019-04-19', '2019-04-22', '2019-04-23', '2019-04-24', '2019-04-25', '2019-04-26', '2019-04-29',
              '2019-04-30', '2019-05-06', '2019-05-07', '2019-05-08', '2019-05-09', '2019-05-10', '2019-05-13',
              '2019-05-14', '2019-05-15', '2019-05-16', '2019-05-17', '2019-05-20', '2019-05-21', '2019-05-22',
              '2019-05-23', '2019-05-24', '2019-05-27', '2019-05-28', '2019-05-29', '2019-05-30', '2019-05-31',
              '2019-06-03', '2019-06-04', '2019-06-05', '2019-06-06', '2019-06-10', '2019-06-11', '2019-06-12',
              '2019-06-13', '2019-06-14', '2019-06-17', '2019-06-18', '2019-06-19', '2019-06-20', '2019-06-21',
              '2019-06-24', '2019-06-25', '2019-06-26', '2019-06-27', '2019-06-28', '2019-07-01', '2019-07-02',
              '2019-07-03', '2019-07-04', '2019-07-05', '2019-07-08', '2019-07-09', '2019-07-10', '2019-07-11',
              '2019-07-12', '2019-07-15', '2019-07-16', '2019-07-17', '2019-07-18', '2019-07-19', '2019-07-22',
              '2019-07-23', '2019-07-24', '2019-07-25', '2019-07-26', '2019-07-29', '2019-07-30', '2019-07-31',
              '2019-08-01', '2019-08-02', '2019-08-05', '2019-08-06', '2019-08-07', '2019-08-08', '2019-08-09',
              '2019-08-12', '2019-08-13', '2019-08-14', '2019-08-15', '2019-08-16', '2019-08-19', '2019-08-20',
              '2019-08-21', '2019-08-22', '2019-08-23', '2019-08-26', '2019-08-27', '2019-08-28', '2019-08-29',
              '2019-08-30', '2019-09-02', '2019-09-03', '2019-09-04', '2019-09-05', '2019-09-06', '2019-09-09',
              '2019-09-10', '2019-09-11', '2019-09-12', '2019-09-16', '2019-09-17', '2019-09-18', '2019-09-19',
              '2019-09-20', '2019-09-23', '2019-09-24', '2019-09-25', '2019-09-26', '2019-09-27', '2019-09-30',
              '2019-10-08', '2019-10-09', '2019-10-10', '2019-10-11', '2019-10-14', '2019-10-15', '2019-10-16',
              '2019-10-17', '2019-10-18', '2019-10-21', '2019-10-22', '2019-10-23', '2019-10-24', '2019-10-25',
              '2019-10-28', '2019-10-29', '2019-10-30', '2019-10-31', '2019-11-01', '2019-11-04', '2019-11-05',
              '2019-11-06', '2019-11-07', '2019-11-08', '2019-11-11', '2019-11-12', '2019-11-13', '2019-11-14',
              '2019-11-15', '2019-11-18', '2019-11-19', '2019-11-20', '2019-11-21', '2019-11-22', '2019-11-25',
              '2019-11-26', '2019-11-27', '2019-11-28', '2019-11-29', '2019-12-02', '2019-12-03', '2019-12-04',
              '2019-12-05', '2019-12-06', '2019-12-09', '2019-12-10', '2019-12-11', '2019-12-12', '2019-12-13',
              '2019-12-16', '2019-12-17', '2019-12-18', '2019-12-19', '2019-12-20', '2019-12-23', '2019-12-24',
              '2019-12-25', '2019-12-26', '2019-12-27', '2019-12-30', '2019-12-31', '2020-01-02', '2020-01-03',
              '2020-01-06', '2020-01-07', '2020-01-08', '2020-01-09', '2020-01-10', '2020-01-13', '2020-01-14',
              '2020-01-15', '2020-01-16', '2020-01-17', '2020-01-20', '2020-01-21', '2020-01-22', '2020-01-23',
              '2020-02-03', '2020-02-04', '2020-02-05', '2020-02-06', '2020-02-07', '2020-02-10', '2020-02-11',
              '2020-02-12', '2020-02-13', '2020-02-14', '2020-02-17', '2020-02-18', '2020-02-19', '2020-02-20',
              '2020-02-21', '2020-02-24', '2020-02-25', '2020-02-26', '2020-02-27', '2020-02-28', '2020-03-02',
              '2020-03-03', '2020-03-04', '2020-03-05', '2020-03-06', '2020-03-09', '2020-03-10', '2020-03-11',
              '2020-03-12', '2020-03-13', '2020-03-16', '2020-03-17', '2020-03-18', '2020-03-19', '2020-03-20',
              '2020-03-23', '2020-03-24', '2020-03-25', '2020-03-26', '2020-03-27', '2020-03-30', '2020-03-31',
              '2020-04-01', '2020-04-02', '2020-04-03', '2020-04-07', '2020-04-08', '2020-04-09', '2020-04-10',
              '2020-04-13', '2020-04-14', '2020-04-15', '2020-04-16', '2020-04-17', '2020-04-20', '2020-04-21',
              '2020-04-22', '2020-04-23', '2020-04-24', '2020-04-27', '2020-04-28', '2020-04-29', '2020-04-30',
              '2020-05-06', '2020-05-07', '2020-05-08', '2020-05-11', '2020-05-12', '2020-05-13', '2020-05-14',
              '2020-05-15', '2020-05-18', '2020-05-19', '2020-05-20', '2020-05-21', '2020-05-22', '2020-05-25',
              '2020-05-26', '2020-05-27', '2020-05-28', '2020-05-29', '2020-06-01', '2020-06-02', '2020-06-03',
              '2020-06-04', '2020-06-05', '2020-06-08', '2020-06-09', '2020-06-10', '2020-06-11', '2020-06-12',
              '2020-06-15', '2020-06-16', '2020-06-17', '2020-06-18', '2020-06-19', '2020-06-22', '2020-06-23',
              '2020-06-24', '2020-06-29', '2020-06-30', '2020-07-01', '2020-07-02', '2020-07-03', '2020-07-06',
              '2020-07-07', '2020-07-08', '2020-07-09', '2020-07-10', '2020-07-13', '2020-07-14', '2020-07-15',
              '2020-07-16', '2020-07-17', '2020-07-20', '2020-07-21', '2020-07-22', '2020-07-23', '2020-07-24',
              '2020-07-27', '2020-07-28', '2020-07-29', '2020-07-30', '2020-07-31', '2020-08-03', '2020-08-04',
              '2020-08-05', '2020-08-06', '2020-08-07', '2020-08-10', '2020-08-11', '2020-08-12', '2020-08-13',
              '2020-08-14', '2020-08-17', '2020-08-18', '2020-08-19', '2020-08-20', '2020-08-21', '2020-08-24',
              '2020-08-25', '2020-08-26', '2020-08-27', '2020-08-28', '2020-08-31', '2020-09-01', '2020-09-02',
              '2020-09-03', '2020-09-04', '2020-09-07', '2020-09-08', '2020-09-09', '2020-09-10', '2020-09-11',
              '2020-09-14', '2020-09-15', '2020-09-16', '2020-09-17', '2020-09-18', '2020-09-21', '2020-09-22',
              '2020-09-23', '2020-09-24', '2020-09-25', '2020-09-28', '2020-09-29', '2020-09-30', '2020-10-09',
              '2020-10-12', '2020-10-13', '2020-10-14', '2020-10-15', '2020-10-16', '2020-10-19', '2020-10-20',
              '2020-10-21', '2020-10-22', '2020-10-23', '2020-10-26', '2020-10-27', '2020-10-28', '2020-10-29',
              '2020-10-30', '2020-11-02', '2020-11-03', '2020-11-04', '2020-11-05', '2020-11-06', '2020-11-09',
              '2020-11-10', '2020-11-11', '2020-11-12', '2020-11-13', '2020-11-16', '2020-11-17', '2020-11-18',
              '2020-11-19', '2020-11-20', '2020-11-23', '2020-11-24', '2020-11-25', '2020-11-26', '2020-11-27',
              '2020-11-30', '2020-12-01', '2020-12-02', '2020-12-03', '2020-12-04', '2020-12-07', '2020-12-08',
              '2020-12-09', '2020-12-10', '2020-12-11', '2020-12-14', '2020-12-15', '2020-12-16', '2020-12-17',
              '2020-12-18', '2020-12-21', '2020-12-22', '2020-12-23', '2020-12-24', '2020-12-25', '2020-12-28',
              '2020-12-29', '2020-12-30', '2020-12-31', '2021-01-04', '2021-01-05', '2021-01-06', '2021-01-07',
              '2021-01-08', '2021-01-11', '2021-01-12', '2021-01-13', '2021-01-14', '2021-01-15', '2021-01-18',
              '2021-01-19', '2021-01-20', '2021-01-21', '2021-01-22', '2021-01-25', '2021-01-26', '2021-01-27',
              '2021-01-28', '2021-01-29', '2021-02-01', '2021-02-02', '2021-02-03', '2021-02-04', '2021-02-05',
              '2021-02-08', '2021-02-09', '2021-02-10', '2021-02-18', '2021-02-19', '2021-02-22', '2021-02-23',
              '2021-02-24', '2021-02-25', '2021-02-26', '2021-03-01', '2021-03-02', '2021-03-03', '2021-03-04',
              '2021-03-05', '2021-03-08', '2021-03-09', '2021-03-10', '2021-03-11', '2021-03-12', '2021-03-15',
              '2021-03-16', '2021-03-17', '2021-03-18', '2021-03-19', '2021-03-22', '2021-03-23', '2021-03-24',
              '2021-03-25', '2021-03-26', '2021-03-29', '2021-03-30', '2021-03-31', '2021-04-01', '2021-04-02',
              '2021-04-06', '2021-04-07', '2021-04-08', '2021-04-09', '2021-04-12', '2021-04-13', '2021-04-14',
              '2021-04-15', '2021-04-16', '2021-04-19', '2021-04-20', '2021-04-21', '2021-04-22', '2021-04-23',
              '2021-04-26', '2021-04-27', '2021-04-28', '2021-04-29', '2021-04-30', '2021-05-06', '2021-05-07',
              '2021-05-10', '2021-05-11', '2021-05-12', '2021-05-13', '2021-05-14', '2021-05-17', '2021-05-18',
              '2021-05-19', '2021-05-20', '2021-05-21', '2021-05-24', '2021-05-25', '2021-05-26', '2021-05-27',
              '2021-05-28', '2021-05-31', '2021-06-01', '2021-06-02', '2021-06-03', '2021-06-04', '2021-06-07',
              '2021-06-08', '2021-06-09', '2021-06-10', '2021-06-11', '2021-06-15', '2021-06-16', '2021-06-17',
              '2021-06-18', '2021-06-21', '2021-06-22', '2021-06-23', '2021-06-24', '2021-06-25', '2021-06-28',
              '2021-06-29', '2021-06-30', '2021-07-01', '2021-07-02', '2021-07-05', '2021-07-06', '2021-07-07',
              '2021-07-08', '2021-07-09', '2021-07-12', '2021-07-13', '2021-07-14', '2021-07-15', '2021-07-16',
              '2021-07-19', '2021-07-20', '2021-07-21', '2021-07-22', '2021-07-23', '2021-07-26', '2021-07-27',
              '2021-07-28', '2021-07-29', '2021-07-30', '2021-08-02', '2021-08-03', '2021-08-04', '2021-08-05',
              '2021-08-06', '2021-08-09', '2021-08-10', '2021-08-11', '2021-08-12', '2021-08-13', '2021-08-16',
              '2021-08-17', '2021-08-18', '2021-08-19', '2021-08-20', '2021-08-23', '2021-08-24', '2021-08-25',
              '2021-08-26', '2021-08-27', '2021-08-30', '2021-08-31', '2021-09-01', '2021-09-02', '2021-09-03',
              '2021-09-06', '2021-09-07', '2021-09-08', '2021-09-09', '2021-09-10', '2021-09-13', '2021-09-14',
              '2021-09-15', '2021-09-16', '2021-09-17', '2021-09-22', '2021-09-23', '2021-09-24', '2021-09-27',
              '2021-09-28', '2021-09-29', '2021-09-30', '2021-10-08', '2021-10-11', '2021-10-12', '2021-10-13',
              '2021-10-14', '2021-10-15', '2021-10-18', '2021-10-19', '2021-10-20', '2021-10-21', '2021-10-22',
              '2021-10-25', '2021-10-26', '2021-10-27', '2021-10-28', '2021-10-29', '2021-11-01', '2021-11-02',
              '2021-11-03', '2021-11-04', '2021-11-05', '2021-11-08', '2021-11-09', '2021-11-10', '2021-11-11',
              '2021-11-12', '2021-11-15', '2021-11-16', '2021-11-17', '2021-11-18', '2021-11-19', '2021-11-22',
              '2021-11-23', '2021-11-24']
index_price = [1000.000, 1008.831, 1018.808, 1024.344, 1034.655, 1035.645, 1029.977, 1025.421, 1026.641, 1025.852,
               1013.789, 1015.888, 1015.571, 1022.118, 1027.752, 1039.468, 1045.083, 1055.250, 1062.062, 1060.130,
               1039.890, 1035.412, 1030.119, 1017.476, 1023.902, 1028.082, 1013.815, 1013.455, 1012.837, 991.139,
               1009.219, 1016.055, 1018.708, 1026.897, 1025.980, 1037.176, 1034.572, 1032.150, 1035.825, 1029.876,
               1029.258, 1032.115, 1030.383, 1031.402, 1036.504, 1047.742, 1047.387, 1042.313, 1040.757, 1040.649,
               1041.735, 1040.360, 1039.061, 1037.094, 1020.402, 1026.855, 1035.323, 1032.322, 1033.199, 1040.944,
               1047.858, 1046.096, 1045.887, 1047.101, 1046.152, 1048.297, 1045.127, 1042.324, 1038.938, 1033.835,
               1039.583, 1041.897, 1034.850, 1020.779, 1033.354, 1032.891, 1026.343, 1027.935, 1025.707, 1030.653,
               1034.306, 1045.426, 1050.328, 1049.854, 1052.102, 1047.544, 1043.184, 1048.259, 1045.218, 1044.149,
               1045.894, 1050.231, 1052.271, 1045.476, 1042.984, 1034.779, 1029.650, 1020.107, 1005.713, 1010.038,
               1006.247, 997.493, 1007.340, 1011.702, 1014.331, 1008.891, 1007.866, 1012.058, 1007.888, 1003.560,
               992.460, 959.090, 963.537, 959.466, 964.791, 967.406, 968.770, 962.425, 962.581, 978.009, 970.870,
               976.677, 973.937, 972.273, 972.486, 981.795, 984.342, 979.313, 992.141, 994.271, 992.027, 995.178,
               997.865, 999.850, 1008.403, 1010.623, 1014.330, 1014.019, 1006.560, 1003.177, 996.694, 997.300, 993.124,
               986.290, 983.820, 976.192, 984.881, 980.319, 990.115, 991.395, 991.765, 987.376, 981.180, 979.427,
               975.847, 974.486, 980.211, 977.609, 979.235, 980.737, 987.489, 991.169, 988.716, 984.415, 983.362,
               982.429, 985.156, 981.793, 981.058, 980.860, 976.191, 976.135, 975.143, 975.320, 974.200, 969.297,
               971.482, 976.165, 975.386, 981.359, 980.699, 982.086, 977.836, 979.884, 968.885, 966.476, 965.878,
               950.337, 951.688, 949.276, 944.545, 943.697, 937.276, 943.876, 955.227, 951.906, 952.777, 951.217,
               954.223, 952.275, 953.765, 957.267, 960.436, 972.859, 976.005, 972.797, 972.966, 971.847, 968.268,
               973.990, 979.230, 982.504, 990.691, 995.464, 996.372, 985.406, 986.073, 985.832, 980.592, 980.415,
               982.113, 986.939, 983.061, 983.812, 993.916, 994.807, 995.104, 992.569, 992.764, 988.376, 987.923,
               988.328, 993.261, 989.565, 987.445, 983.519, 979.476, 976.208, 971.206, 972.294, 968.990, 968.769,
               967.801, 969.254, 966.912, 968.799, 977.196, 988.973, 991.244, 997.404, 999.763, 1003.562, 1000.736,
               1005.964, 1007.354, 1004.229, 1006.155, 1008.709, 1005.616, 1006.876, 1012.153, 1016.991, 1012.965,
               1008.274, 1006.977, 1006.436, 1017.136, 1027.813, 1034.082, 1043.556, 1048.096, 1045.068, 1061.984,
               1057.039, 1060.301, 1065.026, 1078.592, 1107.726, 1101.148, 1097.518, 1099.219, 1103.312, 1116.377,
               1135.728, 1149.205, 1149.563, 1125.922, 1151.205, 1165.457, 1153.034, 1130.993, 1143.201, 1164.992,
               1174.622, 1172.068, 1185.672, 1185.159, 1173.430, 1147.822, 1151.667, 1146.812, 1167.077, 1198.768,
               1203.097, 1207.581, 1215.386, 1213.011, 1204.443, 1197.535, 1179.969, 1182.200, 1173.821, 1180.311,
               1186.724, 1186.301, 1189.295, 1183.546, 1166.897, 1164.341, 1143.980, 1135.778, 1120.385, 1128.872,
               1091.884, 1098.191, 1102.641, 1103.084, 1123.795, 1118.493, 1120.679, 1134.932, 1137.459, 1119.692,
               1112.327, 1119.261, 1118.588, 1109.056, 1107.111, 1112.211, 1113.715, 1114.074, 1107.333, 1105.533,
               1096.475, 1086.626, 1085.656, 1075.787, 1081.142, 1100.291, 1096.544, 1096.956, 1089.074, 1087.095,
               1086.465, 1093.363, 1106.054, 1116.921, 1116.272, 1111.022, 1114.551, 1121.200, 1121.081, 1138.598,
               1138.090, 1133.570, 1133.309, 1132.868, 1119.731, 1119.088, 1116.222, 1116.058, 1118.216, 1120.368,
               1121.492, 1124.238, 1117.731, 1119.722, 1110.804, 1113.353, 1116.867, 1121.973, 1127.206, 1129.573,
               1134.939, 1136.049, 1133.632, 1129.115, 1122.700, 1114.054, 1118.784, 1121.695, 1120.517, 1125.574,
               1125.170, 1127.057, 1128.788, 1133.851, 1148.451, 1149.154, 1149.709, 1149.432, 1151.953, 1149.848,
               1158.249, 1160.068, 1159.811, 1156.836, 1164.782, 1168.365, 1170.585, 1180.047, 1185.827, 1198.212,
               1200.137, 1195.194, 1196.382, 1195.776, 1181.492, 1181.623, 1186.648, 1191.505, 1185.974, 1187.935,
               1180.436, 1170.305, 1173.080, 1171.173, 1171.140, 1173.063, 1180.873, 1184.241, 1191.796, 1186.252,
               1183.547, 1183.212, 1178.424, 1172.766, 1175.950, 1174.075, 1170.696, 1176.036, 1185.956, 1182.054,
               1171.846, 1167.082, 1171.237, 1174.861, 1179.215, 1177.430, 1182.868, 1182.067, 1173.951, 1172.970,
               1170.972, 1172.632, 1167.989, 1170.457, 1177.480, 1176.515, 1173.333, 1169.703, 1168.484, 1169.567,
               1169.011, 1166.504, 1165.179, 1164.624, 1166.318, 1168.066, 1173.745, 1177.823, 1179.771, 1185.001,
               1187.725, 1187.870, 1194.419, 1207.086, 1217.324, 1221.315, 1220.577, 1219.152, 1210.144, 1221.213,
               1223.266, 1230.816, 1228.596, 1232.864, 1240.365, 1255.845, 1258.030, 1265.389, 1274.538, 1267.260,
               1280.351, 1276.600, 1285.281, 1289.857, 1283.137, 1278.838, 1279.094, 1293.305, 1290.770, 1297.353,
               1272.820, 1209.930, 1244.135, 1265.459, 1284.454, 1283.234, 1294.668, 1295.082, 1313.615, 1310.620,
               1311.852, 1335.269, 1346.953, 1350.320, 1364.566, 1377.366, 1389.611, 1388.152, 1364.359, 1362.476,
               1331.534, 1349.390, 1359.362, 1360.164, 1376.513, 1379.211, 1358.564, 1365.384, 1367.077, 1358.123,
               1352.962, 1327.716, 1334.341, 1343.281, 1361.079, 1388.695, 1327.773, 1353.691, 1390.877, 1385.925,
               1376.418, 1376.156, 1386.340, 1394.256, 1381.052, 1361.648, 1377.484, 1370.321, 1369.389, 1342.179,
               1323.295, 1347.988, 1362.155, 1375.368, 1378.022, 1397.190, 1398.853, 1413.107, 1417.318, 1397.787,
               1408.606, 1407.817, 1401.116, 1408.332, 1418.782, 1390.619, 1398.921, 1403.216, 1402.206, 1400.187,
               1386.871, 1380.949, 1366.463, 1366.750, 1355.679, 1353.076, 1338.219, 1329.079, 1345.560, 1346.462,
               1341.722, 1353.341, 1375.143, 1377.151, 1376.476, 1375.334, 1372.006, 1372.569, 1373.461, 1370.920,
               1368.411, 1368.589, 1370.040, 1381.137, 1383.471, 1383.900, 1386.875, 1384.351, 1375.920, 1373.760,
               1367.248, 1375.698, 1379.825, 1396.935, 1413.056, 1455.434, 1465.302, 1478.651, 1499.189, 1484.737,
               1521.365, 1508.890, 1486.438, 1434.755, 1438.069, 1469.707, 1474.983, 1485.809, 1486.329, 1449.840,
               1445.345, 1459.697, 1480.498, 1482.722, 1493.605, 1520.296, 1515.735, 1528.770, 1524.765, 1523.073,
               1546.254, 1529.972, 1527.723, 1538.860, 1534.013, 1552.160, 1559.797, 1551.951, 1543.322, 1545.143,
               1544.896, 1545.220, 1529.150, 1536.551, 1543.189, 1549.084, 1555.668, 1562.357, 1558.295, 1554.368,
               1537.006, 1531.796, 1504.944, 1483.875, 1492.808, 1501.153, 1504.290, 1499.521, 1500.136, 1508.207,
               1508.041, 1497.832, 1497.113, 1473.533, 1467.344, 1454.916, 1467.472, 1470.583, 1492.524, 1517.061,
               1524.722, 1522.923, 1521.705, 1520.092, 1524.348, 1545.460, 1548.134, 1582.549, 1551.120, 1587.866,
               1599.410, 1588.214, 1587.944, 1560.044, 1535.973, 1532.271, 1537.343, 1552.132, 1540.600, 1559.072,
               1551.791, 1543.567, 1553.585, 1568.329, 1563.985, 1548.893, 1547.034, 1542.687, 1546.004, 1553.131,
               1559.375, 1554.588, 1549.458, 1544.298, 1544.391, 1552.267, 1551.786, 1545.470, 1548.824, 1549.753,
               1547.738, 1543.157, 1545.040, 1525.202, 1524.394, 1512.687, 1502.537, 1510.651, 1514.261, 1527.541,
               1523.799, 1522.016, 1498.912, 1507.561, 1499.888, 1499.168, 1513.590, 1528.862, 1552.850, 1563.875,
               1558.355, 1543.971, 1535.942, 1526.404, 1532.555, 1516.433, 1521.013, 1528.937, 1542.774, 1542.666,
               1545.520, 1552.738, 1548.561, 1542.645, 1528.607, 1511.211, 1492.185, 1460.297, 1463.393, 1467.198,
               1456.209, 1430.230, 1407.261, 1408.471, 1434.725, 1445.672, 1465.434, 1487.591, 1505.740, 1495.155,
               1483.627, 1474.250, 1470.535, 1488.461, 1488.089, 1502.360, 1491.678, 1496.586, 1488.774, 1481.553,
               1495.835, 1507.727, 1512.446, 1516.106, 1520.639, 1524.653, 1523.921, 1520.401, 1534.130, 1525.646,
               1509.795, 1505.115, 1515.786, 1521.000, 1516.650, 1513.586, 1515.614, 1517.342, 1522.865, 1524.144,
               1526.339, 1526.705, 1514.690, 1513.069, 1519.621, 1515.047, 1523.153, 1543.411, 1547.208, 1544.423,
               1546.678, 1543.832, 1542.829, 1539.558, 1543.515, 1545.537, 1543.760, 1553.733, 1554.821, 1578.174,
               1587.580, 1590.485, 1585.284, 1591.356, 1586.232, 1593.846, 1596.492, 1591.814, 1595.937, 1602.975,
               1608.233, 1615.840, 1623.984, 1622.084, 1631.200, 1633.924, 1628.679, 1630.015, 1630.586, 1631.988,
               1629.507, 1629.263, 1637.198, 1636.199, 1624.369, 1605.721, 1604.436, 1611.496, 1624.614, 1636.587,
               1648.027, 1650.647, 1654.757, 1663.312, 1655.777, 1657.731, 1650.686, 1644.876, 1654.992, 1656.117,
               1673.904, 1680.231, 1690.464, 1712.119, 1729.514, 1730.240, 1723.042, 1725.299, 1722.159, 1722.796,
               1747.087, 1760.854, 1759.111, 1747.712, 1726.198, 1706.071, 1741.165, 1752.831, 1776.915, 1767.711,
               1791.540, 1787.473, 1794.480, 1794.875, 1800.493, 1812.772, 1820.204, 1824.281, 1823.223, 1795.145,
               1799.256, 1800.821, 1794.986, 1822.503, 1835.352, 1849.154, 1847.749, 1851.389, 1865.163, 1863.466,
               1857.112, 1884.672, 1883.862, 1897.237, 1919.359, 1927.401, 1925.570, 1919.774, 1927.760, 1916.039,
               1917.246, 1879.227, 1869.286, 1877.137, 1891.140, 1877.581, 1835.861, 1842.140, 1808.908, 1837.254,
               1845.301, 1842.422, 1811.709, 1807.977, 1819.530, 1824.188, 1837.833, 1852.995, 1858.072, 1857.273,
               1848.525, 1862.518, 1869.707, 1862.808, 1847.570, 1857.861, 1879.505, 1871.968, 1877.022, 1901.724,
               1892.101, 1904.059, 1921.196, 1926.864, 1946.364, 1963.453, 1973.604, 1958.190, 1972.328, 1970.119,
               1991.948, 2016.867, 2018.420, 2021.569]
idx_data = {"2017-12-29": 1000.0, "2018-01-02": 1008.831, "2018-01-03": 1018.808, "2018-01-04": 1024.344,
            "2018-01-05": 1034.655, "2018-01-08": 1035.645, "2018-01-09": 1029.977, "2018-01-10": 1025.421,
            "2018-01-11": 1026.641, "2018-01-12": 1025.852, "2018-01-15": 1013.789, "2018-01-16": 1015.888,
            "2018-01-17": 1015.571, "2018-01-18": 1022.118, "2018-01-19": 1027.752, "2018-01-22": 1039.468,
            "2018-01-23": 1045.083, "2018-01-24": 1055.25, "2018-01-25": 1062.062, "2018-01-26": 1060.13,
            "2018-01-29": 1039.89, "2018-01-30": 1035.412, "2018-01-31": 1030.119, "2018-02-01": 1017.476,
            "2018-02-02": 1023.902, "2018-02-05": 1028.082, "2018-02-06": 1013.815, "2018-02-07": 1013.455,
            "2018-02-08": 1012.837, "2018-02-09": 991.139, "2018-02-12": 1009.219, "2018-02-13": 1016.055,
            "2018-02-14": 1018.708, "2018-02-22": 1026.897, "2018-02-23": 1025.98, "2018-02-26": 1037.176,
            "2018-02-27": 1034.572, "2018-02-28": 1032.15, "2018-03-01": 1035.825, "2018-03-02": 1029.876,
            "2018-03-05": 1029.258, "2018-03-06": 1032.115, "2018-03-07": 1030.383, "2018-03-08": 1031.402,
            "2018-03-09": 1036.504, "2018-03-12": 1047.742, "2018-03-13": 1047.387, "2018-03-14": 1042.313,
            "2018-03-15": 1040.757, "2018-03-16": 1040.649, "2018-03-19": 1041.735, "2018-03-20": 1040.36,
            "2018-03-21": 1039.061, "2018-03-22": 1037.094, "2018-03-23": 1020.402, "2018-03-26": 1026.855,
            "2018-03-27": 1035.323, "2018-03-28": 1032.322, "2018-03-29": 1033.199, "2018-03-30": 1040.944,
            "2018-04-02": 1047.858, "2018-04-03": 1046.096, "2018-04-04": 1045.887, "2018-04-09": 1047.101,
            "2018-04-10": 1046.152, "2018-04-11": 1048.297, "2018-04-12": 1045.127, "2018-04-13": 1042.324,
            "2018-04-16": 1038.938, "2018-04-17": 1033.835, "2018-04-18": 1039.583, "2018-04-19": 1041.897,
            "2018-04-20": 1034.85, "2018-04-23": 1020.779, "2018-04-24": 1033.354, "2018-04-25": 1032.891,
            "2018-04-26": 1026.343, "2018-04-27": 1027.935, "2018-05-02": 1025.707, "2018-05-03": 1030.653,
            "2018-05-04": 1034.306, "2018-05-07": 1045.426, "2018-05-08": 1050.328, "2018-05-09": 1049.854,
            "2018-05-10": 1052.102, "2018-05-11": 1047.544, "2018-05-14": 1043.184, "2018-05-15": 1048.259,
            "2018-05-16": 1045.218, "2018-05-17": 1044.149, "2018-05-18": 1045.894, "2018-05-21": 1050.231,
            "2018-05-22": 1052.271, "2018-05-23": 1045.476, "2018-05-24": 1042.984, "2018-05-25": 1034.779,
            "2018-05-28": 1029.65, "2018-05-29": 1020.107, "2018-05-30": 1005.713, "2018-05-31": 1010.038,
            "2018-06-01": 1006.247, "2018-06-04": 997.493, "2018-06-05": 1007.34, "2018-06-06": 1011.702,
            "2018-06-07": 1014.331, "2018-06-08": 1008.891, "2018-06-11": 1007.866, "2018-06-12": 1012.058,
            "2018-06-13": 1007.888, "2018-06-14": 1003.56, "2018-06-15": 992.46, "2018-06-19": 959.09,
            "2018-06-20": 963.537, "2018-06-21": 959.466, "2018-06-22": 964.791, "2018-06-25": 967.406,
            "2018-06-26": 968.77, "2018-06-27": 962.425, "2018-06-28": 962.581, "2018-06-29": 978.009,
            "2018-07-02": 970.87, "2018-07-03": 976.677, "2018-07-04": 973.937, "2018-07-05": 972.273,
            "2018-07-06": 972.486, "2018-07-09": 981.795, "2018-07-10": 984.342, "2018-07-11": 979.313,
            "2018-07-12": 992.141, "2018-07-13": 994.271, "2018-07-16": 992.027, "2018-07-17": 995.178,
            "2018-07-18": 997.865, "2018-07-19": 999.85, "2018-07-20": 1008.403, "2018-07-23": 1010.623,
            "2018-07-24": 1014.33, "2018-07-25": 1014.019, "2018-07-26": 1006.56, "2018-07-27": 1003.177,
            "2018-07-30": 996.694, "2018-07-31": 997.3, "2018-08-01": 993.124, "2018-08-02": 986.29,
            "2018-08-03": 983.82, "2018-08-06": 976.192, "2018-08-07": 984.881, "2018-08-08": 980.319,
            "2018-08-09": 990.115, "2018-08-10": 991.395, "2018-08-13": 991.765, "2018-08-14": 987.376,
            "2018-08-15": 981.18, "2018-08-16": 979.427, "2018-08-17": 975.847, "2018-08-20": 974.486,
            "2018-08-21": 980.211, "2018-08-22": 977.609, "2018-08-23": 979.235, "2018-08-24": 980.737,
            "2018-08-27": 987.489, "2018-08-28": 991.169, "2018-08-29": 988.716, "2018-08-30": 984.415,
            "2018-08-31": 983.362, "2018-09-03": 982.429, "2018-09-04": 985.156, "2018-09-05": 981.793,
            "2018-09-06": 981.058, "2018-09-07": 980.86, "2018-09-10": 976.191, "2018-09-11": 976.135,
            "2018-09-12": 975.143, "2018-09-13": 975.32, "2018-09-14": 974.2, "2018-09-17": 969.297,
            "2018-09-18": 971.482, "2018-09-19": 976.165, "2018-09-20": 975.386, "2018-09-21": 981.359,
            "2018-09-25": 980.699, "2018-09-26": 982.086, "2018-09-27": 977.836, "2018-09-28": 979.884,
            "2018-10-08": 968.885, "2018-10-09": 966.476, "2018-10-10": 965.878, "2018-10-11": 950.337,
            "2018-10-12": 951.688, "2018-10-15": 949.276, "2018-10-16": 944.545, "2018-10-17": 943.697,
            "2018-10-18": 937.276, "2018-10-19": 943.876, "2018-10-22": 955.227, "2018-10-23": 951.906,
            "2018-10-24": 952.777, "2018-10-25": 951.217, "2018-10-26": 954.223, "2018-10-29": 952.275,
            "2018-10-30": 953.765, "2018-10-31": 957.267, "2018-11-01": 960.436, "2018-11-02": 972.859,
            "2018-11-05": 976.005, "2018-11-06": 972.797, "2018-11-07": 972.966, "2018-11-08": 971.847,
            "2018-11-09": 968.268, "2018-11-12": 973.99, "2018-11-13": 979.23, "2018-11-14": 982.504,
            "2018-11-15": 990.691, "2018-11-16": 995.464, "2018-11-19": 996.372, "2018-11-20": 985.406,
            "2018-11-21": 986.073, "2018-11-22": 985.832, "2018-11-23": 980.592, "2018-11-26": 980.415,
            "2018-11-27": 982.113, "2018-11-28": 986.939, "2018-11-29": 983.061, "2018-11-30": 983.812,
            "2018-12-03": 993.916, "2018-12-04": 994.807, "2018-12-05": 995.104, "2018-12-06": 992.569,
            "2018-12-07": 992.764, "2018-12-10": 988.376, "2018-12-11": 987.923, "2018-12-12": 988.328,
            "2018-12-13": 993.261, "2018-12-14": 989.565, "2018-12-17": 987.445, "2018-12-18": 983.519,
            "2018-12-19": 979.476, "2018-12-20": 976.208, "2018-12-21": 971.206, "2018-12-24": 972.294,
            "2018-12-25": 968.99, "2018-12-26": 968.769, "2018-12-27": 967.801, "2018-12-28": 969.254,
            "2019-01-02": 966.912, "2019-01-03": 968.799, "2019-01-04": 977.196, "2019-01-07": 988.973,
            "2019-01-08": 991.244, "2019-01-09": 997.404, "2019-01-10": 999.763, "2019-01-11": 1003.562,
            "2019-01-14": 1000.736, "2019-01-15": 1005.964, "2019-01-16": 1007.354, "2019-01-17": 1004.229,
            "2019-01-18": 1006.155, "2019-01-21": 1008.709, "2019-01-22": 1005.616, "2019-01-23": 1006.876,
            "2019-01-24": 1012.153, "2019-01-25": 1016.991, "2019-01-28": 1012.965, "2019-01-29": 1008.274,
            "2019-01-30": 1006.977, "2019-01-31": 1006.436, "2019-02-01": 1017.136, "2019-02-11": 1027.813,
            "2019-02-12": 1034.082, "2019-02-13": 1043.556, "2019-02-14": 1048.096, "2019-02-15": 1045.068,
            "2019-02-18": 1061.984, "2019-02-19": 1057.039, "2019-02-20": 1060.301, "2019-02-21": 1065.026,
            "2019-02-22": 1078.592, "2019-02-25": 1107.726, "2019-02-26": 1101.148, "2019-02-27": 1097.518,
            "2019-02-28": 1099.219, "2019-03-01": 1103.312, "2019-03-04": 1116.377, "2019-03-05": 1135.728,
            "2019-03-06": 1149.205, "2019-03-07": 1149.563, "2019-03-08": 1125.922, "2019-03-11": 1151.205,
            "2019-03-12": 1165.457, "2019-03-13": 1153.034, "2019-03-14": 1130.993, "2019-03-15": 1143.201,
            "2019-03-18": 1164.992, "2019-03-19": 1174.622, "2019-03-20": 1172.068, "2019-03-21": 1185.672,
            "2019-03-22": 1185.159, "2019-03-25": 1173.43, "2019-03-26": 1147.822, "2019-03-27": 1151.667,
            "2019-03-28": 1146.812, "2019-03-29": 1167.077, "2019-04-01": 1198.768, "2019-04-02": 1203.097,
            "2019-04-03": 1207.581, "2019-04-04": 1215.386, "2019-04-08": 1213.011, "2019-04-09": 1204.443,
            "2019-04-10": 1197.535, "2019-04-11": 1179.969, "2019-04-12": 1182.2, "2019-04-15": 1173.821,
            "2019-04-16": 1180.311, "2019-04-17": 1186.724, "2019-04-18": 1186.301, "2019-04-19": 1189.295,
            "2019-04-22": 1183.546, "2019-04-23": 1166.897, "2019-04-24": 1164.341, "2019-04-25": 1143.98,
            "2019-04-26": 1135.778, "2019-04-29": 1120.385, "2019-04-30": 1128.872, "2019-05-06": 1091.884,
            "2019-05-07": 1098.191, "2019-05-08": 1102.641, "2019-05-09": 1103.084, "2019-05-10": 1123.795,
            "2019-05-13": 1118.493, "2019-05-14": 1120.679, "2019-05-15": 1134.932, "2019-05-16": 1137.459,
            "2019-05-17": 1119.692, "2019-05-20": 1112.327, "2019-05-21": 1119.261, "2019-05-22": 1118.588,
            "2019-05-23": 1109.056, "2019-05-24": 1107.111, "2019-05-27": 1112.211, "2019-05-28": 1113.715,
            "2019-05-29": 1114.074, "2019-05-30": 1107.333, "2019-05-31": 1105.533, "2019-06-03": 1096.475,
            "2019-06-04": 1086.626, "2019-06-05": 1085.656, "2019-06-06": 1075.787, "2019-06-10": 1081.142,
            "2019-06-11": 1100.291, "2019-06-12": 1096.544, "2019-06-13": 1096.956, "2019-06-14": 1089.074,
            "2019-06-17": 1087.095, "2019-06-18": 1086.465, "2019-06-19": 1093.363, "2019-06-20": 1106.054,
            "2019-06-21": 1116.921, "2019-06-24": 1116.272, "2019-06-25": 1111.022, "2019-06-26": 1114.551,
            "2019-06-27": 1121.2, "2019-06-28": 1121.081, "2019-07-01": 1138.598, "2019-07-02": 1138.09,
            "2019-07-03": 1133.57, "2019-07-04": 1133.309, "2019-07-05": 1132.868, "2019-07-08": 1119.731,
            "2019-07-09": 1119.088, "2019-07-10": 1116.222, "2019-07-11": 1116.058, "2019-07-12": 1118.216,
            "2019-07-15": 1120.368, "2019-07-16": 1121.492, "2019-07-17": 1124.238, "2019-07-18": 1117.731,
            "2019-07-19": 1119.722, "2019-07-22": 1110.804, "2019-07-23": 1113.353, "2019-07-24": 1116.867,
            "2019-07-25": 1121.973, "2019-07-26": 1127.206, "2019-07-29": 1129.573, "2019-07-30": 1134.939,
            "2019-07-31": 1136.049, "2019-08-01": 1133.632, "2019-08-02": 1129.115, "2019-08-05": 1122.7,
            "2019-08-06": 1114.054, "2019-08-07": 1118.784, "2019-08-08": 1121.695, "2019-08-09": 1120.517,
            "2019-08-12": 1125.574, "2019-08-13": 1125.17, "2019-08-14": 1127.057, "2019-08-15": 1128.788,
            "2019-08-16": 1133.851, "2019-08-19": 1148.451, "2019-08-20": 1149.154, "2019-08-21": 1149.709,
            "2019-08-22": 1149.432, "2019-08-23": 1151.953, "2019-08-26": 1149.848, "2019-08-27": 1158.249,
            "2019-08-28": 1160.068, "2019-08-29": 1159.811, "2019-08-30": 1156.836, "2019-09-02": 1164.782,
            "2019-09-03": 1168.365, "2019-09-04": 1170.585, "2019-09-05": 1180.047, "2019-09-06": 1185.827,
            "2019-09-09": 1198.212, "2019-09-10": 1200.137, "2019-09-11": 1195.194, "2019-09-12": 1196.382,
            "2019-09-16": 1195.776, "2019-09-17": 1181.492, "2019-09-18": 1181.623, "2019-09-19": 1186.648,
            "2019-09-20": 1191.505, "2019-09-23": 1185.974, "2019-09-24": 1187.935, "2019-09-25": 1180.436,
            "2019-09-26": 1170.305, "2019-09-27": 1173.08, "2019-09-30": 1171.173, "2019-10-08": 1171.14,
            "2019-10-09": 1173.063, "2019-10-10": 1180.873, "2019-10-11": 1184.241, "2019-10-14": 1191.796,
            "2019-10-15": 1186.252, "2019-10-16": 1183.547, "2019-10-17": 1183.212, "2019-10-18": 1178.424,
            "2019-10-21": 1172.766, "2019-10-22": 1175.95, "2019-10-23": 1174.075, "2019-10-24": 1170.696,
            "2019-10-25": 1176.036, "2019-10-28": 1185.956, "2019-10-29": 1182.054, "2019-10-30": 1171.846,
            "2019-10-31": 1167.082, "2019-11-01": 1171.237, "2019-11-04": 1174.861, "2019-11-05": 1179.215,
            "2019-11-06": 1177.43, "2019-11-07": 1182.868, "2019-11-08": 1182.067, "2019-11-11": 1173.951,
            "2019-11-12": 1172.97, "2019-11-13": 1170.972, "2019-11-14": 1172.632, "2019-11-15": 1167.989,
            "2019-11-18": 1170.457, "2019-11-19": 1177.48, "2019-11-20": 1176.515, "2019-11-21": 1173.333,
            "2019-11-22": 1169.703, "2019-11-25": 1168.484, "2019-11-26": 1169.567, "2019-11-27": 1169.011,
            "2019-11-28": 1166.504, "2019-11-29": 1165.179, "2019-12-02": 1164.624, "2019-12-03": 1166.318,
            "2019-12-04": 1168.066, "2019-12-05": 1173.745, "2019-12-06": 1177.823, "2019-12-09": 1179.771,
            "2019-12-10": 1185.001, "2019-12-11": 1187.725, "2019-12-12": 1187.87, "2019-12-13": 1194.419,
            "2019-12-16": 1207.086, "2019-12-17": 1217.324, "2019-12-18": 1221.315, "2019-12-19": 1220.577,
            "2019-12-20": 1219.152, "2019-12-23": 1210.144, "2019-12-24": 1221.213, "2019-12-25": 1223.266,
            "2019-12-26": 1230.816, "2019-12-27": 1228.596, "2019-12-30": 1232.864, "2019-12-31": 1240.365,
            "2020-01-02": 1255.845, "2020-01-03": 1258.03, "2020-01-06": 1265.389, "2020-01-07": 1274.538,
            "2020-01-08": 1267.26, "2020-01-09": 1280.351, "2020-01-10": 1276.6, "2020-01-13": 1285.281,
            "2020-01-14": 1289.857, "2020-01-15": 1283.137, "2020-01-16": 1278.838, "2020-01-17": 1279.094,
            "2020-01-20": 1293.305, "2020-01-21": 1290.77, "2020-01-22": 1297.353, "2020-01-23": 1272.82,
            "2020-02-03": 1209.93, "2020-02-04": 1244.135, "2020-02-05": 1265.459, "2020-02-06": 1284.454,
            "2020-02-07": 1283.234, "2020-02-10": 1294.668, "2020-02-11": 1295.082, "2020-02-12": 1313.615,
            "2020-02-13": 1310.62, "2020-02-14": 1311.852, "2020-02-17": 1335.269, "2020-02-18": 1346.953,
            "2020-02-19": 1350.32, "2020-02-20": 1364.566, "2020-02-21": 1377.366, "2020-02-24": 1389.611,
            "2020-02-25": 1388.152, "2020-02-26": 1364.359, "2020-02-27": 1362.476, "2020-02-28": 1331.534,
            "2020-03-02": 1349.39, "2020-03-03": 1359.362, "2020-03-04": 1360.164, "2020-03-05": 1376.513,
            "2020-03-06": 1379.211, "2020-03-09": 1358.564, "2020-03-10": 1365.384, "2020-03-11": 1367.077,
            "2020-03-12": 1358.123, "2020-03-13": 1352.962, "2020-03-16": 1327.716, "2020-03-17": 1334.341,
            "2020-03-18": 1343.281, "2020-03-19": 1361.079, "2020-03-20": 1388.695, "2020-03-23": 1327.773,
            "2020-03-24": 1353.691, "2020-03-25": 1390.877, "2020-03-26": 1385.925, "2020-03-27": 1376.418,
            "2020-03-30": 1376.156, "2020-03-31": 1386.34, "2020-04-01": 1394.256, "2020-04-02": 1381.052,
            "2020-04-03": 1361.648, "2020-04-07": 1377.484, "2020-04-08": 1370.321, "2020-04-09": 1369.389,
            "2020-04-10": 1342.179, "2020-04-13": 1323.295, "2020-04-14": 1347.988, "2020-04-15": 1362.155,
            "2020-04-16": 1375.368, "2020-04-17": 1378.022, "2020-04-20": 1397.19, "2020-04-21": 1398.853,
            "2020-04-22": 1413.107, "2020-04-23": 1417.318, "2020-04-24": 1397.787, "2020-04-27": 1408.606,
            "2020-04-28": 1407.817, "2020-04-29": 1401.116, "2020-04-30": 1408.332, "2020-05-06": 1418.782,
            "2020-05-07": 1390.619, "2020-05-08": 1398.921, "2020-05-11": 1403.216, "2020-05-12": 1402.206,
            "2020-05-13": 1400.187, "2020-05-14": 1386.871, "2020-05-15": 1380.949, "2020-05-18": 1366.463,
            "2020-05-19": 1366.75, "2020-05-20": 1355.679, "2020-05-21": 1353.076, "2020-05-22": 1338.219,
            "2020-05-25": 1329.079, "2020-05-26": 1345.56, "2020-05-27": 1346.462, "2020-05-28": 1341.722,
            "2020-05-29": 1353.341, "2020-06-01": 1375.143, "2020-06-02": 1377.151, "2020-06-03": 1376.476,
            "2020-06-04": 1375.334, "2020-06-05": 1372.006, "2020-06-08": 1372.569, "2020-06-09": 1373.461,
            "2020-06-10": 1370.92, "2020-06-11": 1368.411, "2020-06-12": 1368.589, "2020-06-15": 1370.04,
            "2020-06-16": 1381.137, "2020-06-17": 1383.471, "2020-06-18": 1383.9, "2020-06-19": 1386.875,
            "2020-06-22": 1384.351, "2020-06-23": 1375.92, "2020-06-24": 1373.76, "2020-06-29": 1367.248,
            "2020-06-30": 1375.698, "2020-07-01": 1379.825, "2020-07-02": 1396.935, "2020-07-03": 1413.056,
            "2020-07-06": 1455.434, "2020-07-07": 1465.302, "2020-07-08": 1478.651, "2020-07-09": 1499.189,
            "2020-07-10": 1484.737, "2020-07-13": 1521.365, "2020-07-14": 1508.89, "2020-07-15": 1486.438,
            "2020-07-16": 1434.755, "2020-07-17": 1438.069, "2020-07-20": 1469.707, "2020-07-21": 1474.983,
            "2020-07-22": 1485.809, "2020-07-23": 1486.329, "2020-07-24": 1449.84, "2020-07-27": 1445.345,
            "2020-07-28": 1459.697, "2020-07-29": 1480.498, "2020-07-30": 1482.722, "2020-07-31": 1493.605,
            "2020-08-03": 1520.296, "2020-08-04": 1515.735, "2020-08-05": 1528.77, "2020-08-06": 1524.765,
            "2020-08-07": 1523.073, "2020-08-10": 1546.254, "2020-08-11": 1529.972, "2020-08-12": 1527.723,
            "2020-08-13": 1538.86, "2020-08-14": 1534.013, "2020-08-17": 1552.16, "2020-08-18": 1559.797,
            "2020-08-19": 1551.951, "2020-08-20": 1543.322, "2020-08-21": 1545.143, "2020-08-24": 1544.896,
            "2020-08-25": 1545.22, "2020-08-26": 1529.15, "2020-08-27": 1536.551, "2020-08-28": 1543.189,
            "2020-08-31": 1549.084, "2020-09-01": 1555.668, "2020-09-02": 1562.357, "2020-09-03": 1558.295,
            "2020-09-04": 1554.368, "2020-09-07": 1537.006, "2020-09-08": 1531.796, "2020-09-09": 1504.944,
            "2020-09-10": 1483.875, "2020-09-11": 1492.808, "2020-09-14": 1501.153, "2020-09-15": 1504.29,
            "2020-09-16": 1499.521, "2020-09-17": 1500.136, "2020-09-18": 1508.207, "2020-09-21": 1508.041,
            "2020-09-22": 1497.832, "2020-09-23": 1497.113, "2020-09-24": 1473.533, "2020-09-25": 1467.344,
            "2020-09-28": 1454.916, "2020-09-29": 1467.472, "2020-09-30": 1470.583, "2020-10-09": 1492.524,
            "2020-10-12": 1517.061, "2020-10-13": 1524.722, "2020-10-14": 1522.923, "2020-10-15": 1521.705,
            "2020-10-16": 1520.092, "2020-10-19": 1524.348, "2020-10-20": 1545.46, "2020-10-21": 1548.134,
            "2020-10-22": 1582.549, "2020-10-23": 1551.12, "2020-10-26": 1587.866, "2020-10-27": 1599.41,
            "2020-10-28": 1588.214, "2020-10-29": 1587.944, "2020-10-30": 1560.044, "2020-11-02": 1535.973,
            "2020-11-03": 1532.271, "2020-11-04": 1537.343, "2020-11-05": 1552.132, "2020-11-06": 1540.6,
            "2020-11-09": 1559.072, "2020-11-10": 1551.791, "2020-11-11": 1543.567, "2020-11-12": 1553.585,
            "2020-11-13": 1568.329, "2020-11-16": 1563.985, "2020-11-17": 1548.893, "2020-11-18": 1547.034,
            "2020-11-19": 1542.687, "2020-11-20": 1546.004, "2020-11-23": 1553.131, "2020-11-24": 1559.375,
            "2020-11-25": 1554.588, "2020-11-26": 1549.458, "2020-11-27": 1544.298, "2020-11-30": 1544.391,
            "2020-12-01": 1552.267, "2020-12-02": 1551.786, "2020-12-03": 1545.47, "2020-12-04": 1548.824,
            "2020-12-07": 1549.753, "2020-12-08": 1547.738, "2020-12-09": 1543.157, "2020-12-10": 1545.04,
            "2020-12-11": 1525.202, "2020-12-14": 1524.394, "2020-12-15": 1512.687, "2020-12-16": 1502.537,
            "2020-12-17": 1510.651, "2020-12-18": 1514.261, "2020-12-21": 1527.541, "2020-12-22": 1523.799,
            "2020-12-23": 1522.016, "2020-12-24": 1498.912, "2020-12-25": 1507.561, "2020-12-28": 1499.888,
            "2020-12-29": 1499.168, "2020-12-30": 1513.59, "2020-12-31": 1528.862, "2021-01-04": 1552.85,
            "2021-01-05": 1563.875, "2021-01-06": 1558.355, "2021-01-07": 1543.971, "2021-01-08": 1535.942,
            "2021-01-11": 1526.404, "2021-01-12": 1532.555, "2021-01-13": 1516.433, "2021-01-14": 1521.013,
            "2021-01-15": 1528.937, "2021-01-18": 1542.774, "2021-01-19": 1542.666, "2021-01-20": 1545.52,
            "2021-01-21": 1552.738, "2021-01-22": 1548.561, "2021-01-25": 1542.645, "2021-01-26": 1528.607,
            "2021-01-27": 1511.211, "2021-01-28": 1492.185, "2021-01-29": 1460.297, "2021-02-01": 1463.393,
            "2021-02-02": 1467.198, "2021-02-03": 1456.209, "2021-02-04": 1430.23, "2021-02-05": 1407.261,
            "2021-02-08": 1408.471, "2021-02-09": 1434.725, "2021-02-10": 1445.672, "2021-02-18": 1465.434,
            "2021-02-19": 1487.591, "2021-02-22": 1505.74, "2021-02-23": 1495.155, "2021-02-24": 1483.627,
            "2021-02-25": 1474.25, "2021-02-26": 1470.535, "2021-03-01": 1488.461, "2021-03-02": 1488.089,
            "2021-03-03": 1502.36, "2021-03-04": 1491.678, "2021-03-05": 1496.586, "2021-03-08": 1488.774,
            "2021-03-09": 1481.553, "2021-03-10": 1495.835, "2021-03-11": 1507.727, "2021-03-12": 1512.446,
            "2021-03-15": 1516.106, "2021-03-16": 1520.639, "2021-03-17": 1524.653, "2021-03-18": 1523.921,
            "2021-03-19": 1520.401, "2021-03-22": 1534.13, "2021-03-23": 1525.646, "2021-03-24": 1509.795,
            "2021-03-25": 1505.115, "2021-03-26": 1515.786, "2021-03-29": 1521.0, "2021-03-30": 1516.65,
            "2021-03-31": 1513.586, "2021-04-01": 1515.614, "2021-04-02": 1517.342, "2021-04-06": 1522.865,
            "2021-04-07": 1524.144, "2021-04-08": 1526.339, "2021-04-09": 1526.705, "2021-04-12": 1514.69,
            "2021-04-13": 1513.069, "2021-04-14": 1519.621, "2021-04-15": 1515.047, "2021-04-16": 1523.153,
            "2021-04-19": 1543.411, "2021-04-20": 1547.208, "2021-04-21": 1544.423, "2021-04-22": 1546.678,
            "2021-04-23": 1543.832, "2021-04-26": 1542.829, "2021-04-27": 1539.558, "2021-04-28": 1543.515,
            "2021-04-29": 1545.537, "2021-04-30": 1543.76, "2021-05-06": 1553.733, "2021-05-07": 1554.821,
            "2021-05-10": 1578.174, "2021-05-11": 1587.58, "2021-05-12": 1590.485, "2021-05-13": 1585.284,
            "2021-05-14": 1591.356, "2021-05-17": 1586.232, "2021-05-18": 1593.846, "2021-05-19": 1596.492,
            "2021-05-20": 1591.814, "2021-05-21": 1595.937, "2021-05-24": 1602.975, "2021-05-25": 1608.233,
            "2021-05-26": 1615.84, "2021-05-27": 1623.984, "2021-05-28": 1622.084, "2021-05-31": 1631.2,
            "2021-06-01": 1633.924, "2021-06-02": 1628.679, "2021-06-03": 1630.015, "2021-06-04": 1630.586,
            "2021-06-07": 1631.988, "2021-06-08": 1629.507, "2021-06-09": 1629.263, "2021-06-10": 1637.198,
            "2021-06-11": 1636.199, "2021-06-15": 1624.369, "2021-06-16": 1605.721, "2021-06-17": 1604.436,
            "2021-06-18": 1611.496, "2021-06-21": 1624.614, "2021-06-22": 1636.587, "2021-06-23": 1648.027,
            "2021-06-24": 1650.647, "2021-06-25": 1654.757, "2021-06-28": 1663.312, "2021-06-29": 1655.777,
            "2021-06-30": 1657.731, "2021-07-01": 1650.686, "2021-07-02": 1644.876, "2021-07-05": 1654.992,
            "2021-07-06": 1656.117, "2021-07-07": 1673.904, "2021-07-08": 1680.231, "2021-07-09": 1690.464,
            "2021-07-12": 1712.119, "2021-07-13": 1729.514, "2021-07-14": 1730.24, "2021-07-15": 1723.042,
            "2021-07-16": 1725.299, "2021-07-19": 1722.159, "2021-07-20": 1722.796, "2021-07-21": 1747.087,
            "2021-07-22": 1760.854, "2021-07-23": 1759.111, "2021-07-26": 1747.712, "2021-07-27": 1726.198,
            "2021-07-28": 1706.071, "2021-07-29": 1741.165, "2021-07-30": 1752.831, "2021-08-02": 1776.915,
            "2021-08-03": 1767.711, "2021-08-04": 1791.54, "2021-08-05": 1787.473, "2021-08-06": 1794.48,
            "2021-08-09": 1794.875, "2021-08-10": 1800.493, "2021-08-11": 1812.772, "2021-08-12": 1820.204,
            "2021-08-13": 1824.281, "2021-08-16": 1823.223, "2021-08-17": 1795.145, "2021-08-18": 1799.256,
            "2021-08-19": 1800.821, "2021-08-20": 1794.986, "2021-08-23": 1822.503, "2021-08-24": 1835.352,
            "2021-08-25": 1849.154, "2021-08-26": 1847.749, "2021-08-27": 1851.389, "2021-08-30": 1865.163,
            "2021-08-31": 1863.466, "2021-09-01": 1857.112, "2021-09-02": 1884.672, "2021-09-03": 1883.862,
            "2021-09-06": 1897.237, "2021-09-07": 1919.359, "2021-09-08": 1927.401, "2021-09-09": 1925.57,
            "2021-09-10": 1919.774, "2021-09-13": 1927.76, "2021-09-14": 1916.039, "2021-09-15": 1917.246,
            "2021-09-16": 1879.227, "2021-09-17": 1869.286, "2021-09-22": 1877.137, "2021-09-23": 1891.14,
            "2021-09-24": 1877.581, "2021-09-27": 1835.861, "2021-09-28": 1842.14, "2021-09-29": 1808.908,
            "2021-09-30": 1837.254, "2021-10-08": 1845.301, "2021-10-11": 1842.422, "2021-10-12": 1811.709,
            "2021-10-13": 1807.977, "2021-10-14": 1819.53, "2021-10-15": 1824.188, "2021-10-18": 1837.833,
            "2021-10-19": 1852.995, "2021-10-20": 1858.072, "2021-10-21": 1857.273, "2021-10-22": 1848.525,
            "2021-10-25": 1862.518, "2021-10-26": 1869.707, "2021-10-27": 1862.808, "2021-10-28": 1847.57,
            "2021-10-29": 1857.861, "2021-11-01": 1879.505, "2021-11-02": 1871.968, "2021-11-03": 1877.022,
            "2021-11-04": 1901.724, "2021-11-05": 1892.101, "2021-11-08": 1904.059, "2021-11-09": 1921.196,
            "2021-11-10": 1926.864, "2021-11-11": 1946.364, "2021-11-12": 1963.453, "2021-11-15": 1973.604,
            "2021-11-16": 1958.19, "2021-11-17": 1972.328, "2021-11-18": 1970.119, "2021-11-19": 1991.948,
            "2021-11-22": 2016.867, "2021-11-23": 2018.42, "2021-11-24": 2021.569}


def get_data():
    idx_data = {}
    i = 0
    for d in index_date:
        # date = datetime.datetime.strptime(d, '%Y-%m-%d')
        idx_data[d] = index_price[i]
        i += 1

    print(json.dumps(idx_data))


def generate_timeline_html(time_data):
    tl = Timeline()
    tl.add_schema(is_auto_play=False,
                  play_interval=500,
                  is_loop_play=False)
    for date, bonds in time_data.items():
        _date = datetime.datetime.strftime(date, '%Y-%m-%d')
        x = []
        y = []
        bonds = sorted(bonds.items(), key=lambda i: i[1], reverse=False)
        for name, money, in bonds:
            x.append(name)
            y.append(money)

        bar = (
            Bar(init_opts=opts.InitOpts(theme=ThemeType.ROMANTIC))
                .add_xaxis(x)
                .add_yaxis("价格", y)
                # .add_yaxis("投入资金", y)
                .reversal_axis()
                .set_series_opts(label_opts=opts.LabelOpts(is_show=True, position='right'),
                                 )
                .set_global_opts(
                legend_opts=opts.LegendOpts(is_show=True),
                title_opts=opts.TitleOpts("{}可转债组合".format(_date)),
            )
        )
        tl.add(bar, "{}".format(_date))
    return "<center>" + tl.render_embed('template.html', env) + "</center>"


def generate_line_html(rows, period, start, end, bond_num, line_names=[], title=None, max_price=None, max_double_low=None):
    # 用散点图展示
    line = Line(opts.InitOpts(height='700px', width='1424px', theme=ThemeType.LIGHT))

    x, data = get_line_data(rows, line_names)
    # i = 0
    # y1_max = None
    # y1_min = None
    # y2_max = None
    # y2_min = None
    # for e in x:
    #     if i == y1_start:
    #         y1_max = e
    #     elif i == y1_end:
    #         y1_min = e
    #
    #     if i == y2_start:
    #         y2_max = e
    #     elif i == y2_end:
    #         y2_min = e
    #     i += 1
    line.add_xaxis(x)
    for d in data:
        line.add_yaxis(d[0], d[1])

    line.set_global_opts(
        title_opts=opts.TitleOpts(title=title if title is not None else "各种轮动策略回测结果",
                                  subtitle=get_subtitle(bond_num, end, period, start, max_price, max_double_low),
                                  pos_left='center'),
        tooltip_opts=opts.TooltipOpts(
            trigger='axis',
        ),
        legend_opts=opts.LegendOpts(
            pos_top=50,
            pos_left=160,
            orient='vertical'
            # selected_mode='single'
        ),
        datazoom_opts={'start': 0, 'end': 100},
        toolbox_opts=opts.ToolboxOpts(feature={
            'dataZoom': {},
        }
        ),
        # visualmap_opts=opts.VisualMapOpts(
        #     type_="color", max_=150, min_=20, dimension=1
        # ),
        xaxis_opts=opts.AxisOpts(
            # data=None,
            type_='time',
            name='时间',
            name_gap=30,
            is_scale=True,
            name_location='middle',
            splitline_opts=opts.SplitLineOpts(is_show=False),
            # axislabel_opts=opts.LabelOpts(formatter="{value}"), #echarts.format.formatTime('yy-MM-dd', value*1000)
            axisline_opts=opts.AxisLineOpts(
                is_on_zero=False,
                symbol=['none', 'arrow']
            )
        ),
        yaxis_opts=opts.AxisOpts(
            type_='value',
            name='收益率(%)',
            name_rotate=90,
            name_gap=55,
            name_location='middle',
            is_scale=True,
            axislabel_opts=opts.LabelOpts(formatter='{value}%'),
            splitline_opts=opts.SplitLineOpts(is_show=False),
            axisline_opts=opts.AxisLineOpts(
                is_on_zero=False,
                symbol=['none', 'arrow']
            )
        )
    )
    line.set_series_opts(
        symbol='none',
        smooth=False,
        label_opts=opts.LabelOpts(is_show=False),
        # markarea_opts=opts.MarkAreaOpts(
        #     is_silent=False,
        #     data=[
        #         opts.MarkAreaItem(
        #             name="" + str(y1_mdd) + "%",
        #             x=(y1_max, y1_min),
        #             label_opts=opts.LabelOpts(is_show=True, color="#DCA3A2"),
        #             itemstyle_opts=opts.ItemStyleOpts(color="#DCA3A2", opacity=0.5),
        #         ),
        #         opts.MarkAreaItem(
        #             name="" + str(y2_mdd) + "%",
        #             x=(y2_max, y2_min),
        #             label_opts=opts.LabelOpts(is_show=True, color="#b0fca2"),
        #             itemstyle_opts=opts.ItemStyleOpts(color="#b0fca2", opacity=0.5),
        #         )
        #     ]
        # )
    )
    line_html = line.render_embed('template.html', env)
    return "<br/>" + line_html


def get_subtitle(bond_num, end, period, start, max_price, max_double_low):
    s = "回测时间:" + datetime.datetime.strftime(start, '%Y-%m-%d') + "~" + datetime.datetime.strftime(end, '%Y-%m-%d')
    if period is not None and bond_num is not None:
        s += ", " + str(bond_num) + "只可转债, " + str(period) + "个交易日轮动"
    s += ", 价格上限:" + str(max_price) + "元, 估值上限:" + str(max_double_low) + ""
    return s


def get_line_data(rows, line_names=[]):
    data = []
    x = []

    lines_data = {}
    for line_name in line_names:
        lines_data.setdefault(line_name, {"rate": [], "money": [], "day_rate": []})

    add_base_data(lines_data, rows, x)

    for line_data in lines_data.values():
        mdd, start, end, max_profit = get_max_drawdown(x, line_data['rate'], line_data['money'])
        line_data.setdefault('mdd', mdd)
        line_data.setdefault('max_profit', max_profit)
        line_data.setdefault('sharp_ratio', get_sharpe_ratio(line_data['day_rate']))

    for line, line_data in lines_data.items():
        current_rate = line_data['rate'][len(line_data['rate']) - 1]
        data.append(
            [line
             + "(最大回撤:" + str(line_data['mdd']) + "%, "
             + "夏普比率:" + str(line_data['sharp_ratio']) + "%, "
             + "最高收益:" + str(line_data['max_profit']) + "%, "
             + "当前收益:" + str(current_rate) + "%)",
             line_data['rate'], current_rate])

    data = sorted(data, key=lambda d: d[2], reverse=True)
    return x, data


def get_sharpe_ratio(return_list):
    '''夏普比率'''
    average_return = np.mean(return_list)
    return_stdev = np.std(return_list)
    # 10年国债无风险收益率: https://www.chinabond.com.cn/d2s/cbData.html
    sharpe_ratio = (average_return - 0.027957) * np.sqrt(252) / return_stdev  # 默认252个工作日,无风险利率为0.02
    return round(sharpe_ratio, 2)


def add_base_data(lines_data, rows, x):
    base = None
    original_price = 1000
    pre_price = None
    base_rate = 0
    day_rate = 0
    index_line_data = {"rate": [], "money": [], "day_rate": []}
    for date, value in rows.items():
        # fixme idx_data目前是写死的, 后面需要动态更新
        price = idx_data.get(datetime.datetime.strftime(date, '%Y-%m-%d'))
        if pre_price is None:
            pre_price = price

        if base is None:
            if price is not None:
                base = price

        x.append(datetime.datetime.strftime(date, '%Y-%m-%d'))

        i = 0
        for v in lines_data.values():
            v['rate'].append(value[i][0])
            v['money'].append(value[i][1])
            v['day_rate'].append(value[i][2])
            i += 1

        if price is not None:
            base_rate = round((price - base) / base * 100, 2)
            day_rate = round((price - pre_price) / pre_price * 100, 2)
            original_price = price
        index_line_data['rate'].append(base_rate)
        index_line_data['money'].append(original_price)
        index_line_data['day_rate'].append(day_rate)

        pre_price = original_price
    lines_data.setdefault('可转债等权指数', index_line_data)


if __name__ == "__main__":
    # get_data()
    print(round(10 * 2 / 3, 0))
